<?xml version="1.0" encoding="utf-8"?>
<root>
  <!-- 
    Microsoft ResX Schema 
    
    Version 2.0
    
    The primary goals of this format is to allow a simple XML format 
    that is mostly human readable. The generation and parsing of the 
    various data types are done through the TypeConverter classes 
    associated with the data types.
    
    Example:
    
    ... ado.net/XML headers & schema ...
    <resheader name="resmimetype">text/microsoft-resx</resheader>
    <resheader name="version">2.0</resheader>
    <resheader name="reader">System.Resources.ResXResourceReader, System.Windows.Forms, ...</resheader>
    <resheader name="writer">System.Resources.ResXResourceWriter, System.Windows.Forms, ...</resheader>
    <data name="Name1"><value>this is my long string</value><comment>this is a comment</comment></data>
    <data name="Color1" type="System.Drawing.Color, System.Drawing">Blue</data>
    <data name="Bitmap1" mimetype="application/x-microsoft.net.object.binary.base64">
        <value>[base64 mime encoded serialized .NET Framework object]</value>
    </data>
    <data name="Icon1" type="System.Drawing.Icon, System.Drawing" mimetype="application/x-microsoft.net.object.bytearray.base64">
        <value>[base64 mime encoded string representing a byte array form of the .NET Framework object]</value>
        <comment>This is a comment</comment>
    </data>
                
    There are any number of "resheader" rows that contain simple 
    name/value pairs.
    
    Each data row contains a name, and value. The row also contains a 
    type or mimetype. Type corresponds to a .NET class that support 
    text/value conversion through the TypeConverter architecture. 
    Classes that don't support this are serialized and stored with the 
    mimetype set.
    
    The mimetype is used for serialized objects, and tells the 
    ResXResourceReader how to depersist the object. This is currently not 
    extensible. For a given mimetype the value must be set accordingly:
    
    Note - application/x-microsoft.net.object.binary.base64 is the format 
    that the ResXResourceWriter will generate, however the reader can 
    read any of the formats listed below.
    
    mimetype: application/x-microsoft.net.object.binary.base64
    value   : The object must be serialized with 
            : System.Runtime.Serialization.Formatters.Binary.BinaryFormatter
            : and then encoded with base64 encoding.
    
    mimetype: application/x-microsoft.net.object.soap.base64
    value   : The object must be serialized with 
            : System.Runtime.Serialization.Formatters.Soap.SoapFormatter
            : and then encoded with base64 encoding.

    mimetype: application/x-microsoft.net.object.bytearray.base64
    value   : The object must be serialized into a byte array 
            : using a System.ComponentModel.TypeConverter
            : and then encoded with base64 encoding.
    -->
  <xsd:schema id="root" xmlns="" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata">
    <xsd:import namespace="http://www.w3.org/XML/1998/namespace" />
    <xsd:element name="root" msdata:IsDataSet="true">
      <xsd:complexType>
        <xsd:choice maxOccurs="unbounded">
          <xsd:element name="metadata">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" />
              </xsd:sequence>
              <xsd:attribute name="name" use="required" type="xsd:string" />
              <xsd:attribute name="type" type="xsd:string" />
              <xsd:attribute name="mimetype" type="xsd:string" />
              <xsd:attribute ref="xml:space" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="assembly">
            <xsd:complexType>
              <xsd:attribute name="alias" type="xsd:string" />
              <xsd:attribute name="name" type="xsd:string" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="data">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
                <xsd:element name="comment" type="xsd:string" minOccurs="0" msdata:Ordinal="2" />
              </xsd:sequence>
              <xsd:attribute name="name" type="xsd:string" use="required" msdata:Ordinal="1" />
              <xsd:attribute name="type" type="xsd:string" msdata:Ordinal="3" />
              <xsd:attribute name="mimetype" type="xsd:string" msdata:Ordinal="4" />
              <xsd:attribute ref="xml:space" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="resheader">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
              </xsd:sequence>
              <xsd:attribute name="name" type="xsd:string" use="required" />
            </xsd:complexType>
          </xsd:element>
        </xsd:choice>
      </xsd:complexType>
    </xsd:element>
  </xsd:schema>
  <resheader name="resmimetype">
    <value>text/microsoft-resx</value>
  </resheader>
  <resheader name="version">
    <value>2.0</value>
  </resheader>
  <resheader name="reader">
    <value>System.Resources.ResXResourceReader, System.Windows.Forms, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
  </resheader>
  <resheader name="writer">
    <value>System.Resources.ResXResourceWriter, System.Windows.Forms, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
  </resheader>
  <data name="CajaSocial" xml:space="preserve">
    <value>Set @Valor =
(
	Select Sum(LineTotal) As Total from 
		(
			Select LineTotal,
			T1.Cadena1 + Cast(T0.TipoLin As Char(40)) + Cast(UPPER(T0.ItemName) as Char(80)) + '0' + Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
			REPLICATE('0', 18 - DATALENGTH(Replace(Cast(T0.LineTotal as numeric(16,2)),'.',''))) + Replace(Cast(T0.LineTotal as numeric(16,2)),'.','') +
			T1.Cadena2 As 'Cadena', T0.Alumno, T0.Orden
			From (

			Select ItemName, Round(Sum(LineTotal),0) LineTotal, Alumno, '00' As TipoLin, 2 Orden 
			From (
					Select
					'COSTOS EDUCATIVOS' + ' - ' + 
					Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
					Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')  ItemName, 
					A0.DocTotal - A0.PaidToDate 'LineTotal', A0.NumAtCard 'Alumno'
					From OINV A0
					Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
					Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
					Inner Join OADM A3 On 1 = 1
					Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
					Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
					Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
					Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And Year(A0.DocDate)  =  Year(GetDate()) And 
					A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) /*And NumAtCard = '491'*/) And A1.TargetType != '14' 
					Group By A0.DocTotal,A0.PaidToDate, A0.NumAtCard, A0.DocEntry, A4.U_SEINom, A4.U_SEICogn

					Union All

					Select ItemName, Cast(Sum(B0.Saldo)as numeric(16,0))'LineTotal', B0.Alumno 
					From (
							Select 
							'COSTOS EDUCATIVOS' + ' - ' + 
							Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A3.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
							Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A3.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') ItemName, 
							(A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
							From OINV A0
							Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
							Left join OCRD A2 On A0.CardCode = A2.CardCode
							Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
							Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
							Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
							Inner Join OADM A6 On 1 = 1
							Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And Year(A0.DocDate)  =  Year(GetDate()) And 
							A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())) /*And A0.NumAtCard = '491'*/
							Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A3.U_SEINom, A3.U_SEICogn, A0.DocEntry
					) B0
					Group By B0.ItemName, B0.Alumno

					Union All

					Select ItemName, Sum(Saldo) 'LineTotal', Ref2'Alumno' From (
					Select 
					'COSTOS EDUCATIVOS' + ' - ' + 
					Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A5.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
					Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A5.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')  ItemName, 
					Sum(IsNull(A1.Debit,0))- Case When A4.Canceled = 'Y' Then 0 Else IsNull(Sum(A3.SumApplied),0) End 'Saldo', A0.Ref2, A0.TransId
					From OJDT A0 
					Inner Join JDT1 A1 On A0.TransId = A1.TransId 
					Left Join OINV A2 On A0.Ref1 = A2.DocNum 
					Left Join RCT2 A3 On A0.TransId = A3.DocEntry And A0.ObjType = A3.InvType 
					Left Join ORCT A4 On A3.DocNum = A4.DocEntry 
					Left Join [@SEI_ALUMNOS] A5 On IsNull(A2.NumAtCard,'') = A5.Code
					Left Join [@SEI_CURSOS] A6 On A5.U_SEICurso = A6.Code
					Left Join [@SEI_SRVCODE] A7 On A2.U_SEI_FACTU = A7.Code
					Inner Join OCRD A8 ON A2.CardCode = A8.CardCode
					Left Join OADM A9 On 1 = 1
					Where A0.TransCode = 'INT' And A2.U_SEI_FACTU = '1' And IsNull(A0.StornoToTr,'') = '' And A1.BalDueDeb &gt; 0 /*And A0.Ref2 = '491' */
					Group By A0.Ref2, A4.Canceled, A0.TransId, A5.U_SEINom, A5.U_SEICogn
					) C0 
					Where Saldo &gt; 0 And TransId Not In (Select StornoToTr From OJDT Where IsNull(StornoToTr,'') &lt;&gt; '')
					Group By Ref2, ItemName
			)P0
			Group By ItemName, Alumno

			Union All

			Select ItemName, Round(LineTotal,0), Alumno,'01' As TipoLin, 3 Orden 
			From (
					Select ItemName, Sum(B0.Saldo)'LineTotal', B0.Alumno 
					From (
							Select 
							'SALDO ANTERIOR' ItemName, (A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
							From OINV A0
							Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
							Left join OCRD A2 On A0.CardCode = A2.CardCode
							Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
							Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
							Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
							Inner Join OADM A6 On 1 = 1
							Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And Year(A0.DocDate)  =  Year(GetDate()) And
							A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())) /*And A0.NumAtCard = '491'*/
							Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A0.DocEntry
							union 
							Select 
							'SALDO DEL MES ACTUAL' ItemName, (A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
							From OINV A0
							Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
							Left join OCRD A2 On A0.CardCode = A2.CardCode
							Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
							Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
							Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
							Inner Join OADM A6 On 1 = 1
							Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And IsNull(A0.PaidToDate,0) &gt; 0 And
							A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())) /*And A0.NumAtCard = '491'*/
							Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A0.DocEntry
					) B0
					Group By B0.ItemName, B0.Alumno

					Union All

					Select ItemName, Sum(Saldo) 'LineTotal', Ref2'Alumno' 
					From 
					(
						Select 
						'INTERESES DEL MES' ItemName,
						Sum(IsNull(A1.Debit,0)) - Case When A4.Canceled = 'Y' Then 0 Else (Sum(IsNull(A1.Debit,0)) - IsNull(Sum(A1.BalDueDeb),0)) End 'Saldo', A0.Ref2, A0.TransId
						From OJDT A0 
						Inner Join JDT1 A1 On A0.TransId = A1.TransId 
						Left Join OINV A2 On A0.Ref1 = A2.DocNum 
						Left Join RCT2 A3 On A0.TransId = A3.DocEntry And A0.ObjType = A3.InvType 
						Left Join ORCT A4 On A3.DocNum = A4.DocEntry 
						Left Join [@SEI_ALUMNOS] A5 On IsNull(A2.NumAtCard,'') = A5.Code
						Left Join [@SEI_CURSOS] A6 On A5.U_SEICurso = A6.Code
						Left Join [@SEI_SRVCODE] A7 On A2.U_SEI_FACTU = A7.Code
						Inner Join OCRD A8 ON A2.CardCode = A8.CardCode
						Left Join OADM A9 On 1 = 1
						Where A0.TransCode = 'INT' And A2.U_SEI_FACTU = '1' And IsNull(A0.StornoToTr,'') = '' And A1.BalDueDeb &gt; 0 /*And A0.Ref2 = '491' */
						Group By A0.Ref2, A4.Canceled, A0.TransId
					) C0 
					Where Saldo &gt; 0 And TransId Not In (Select StornoToTr From OJDT Where IsNull(StornoToTr,'') &lt;&gt; '')
					Group By Ref2, ItemName

					Union All

					Select * 
					From 
					(
						Select
						A1.Dscription'ItemName', Cast(A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 as numeric(16,2)) 'LineTotal', A0.NumAtCard 'Alumno'
						From OINV A0
						Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
						Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
						Inner Join OADM A3 On 1 = 1
						Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
						Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
						Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc
						Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And IsNull(A0.PaidToDate,0) = 0
						And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) /*And NumAtCard = '491'*/) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' 
					)A0 Where A0.LineTotal &gt; 0
			)P0
			)T0
			Left Join(
						Select
						'2' +
						REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
						REPLICATE('0', 35 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') + 
						CASE WHEN CHARINDEX('-', IsNull(A2.LicTradNum,'')) &gt; 0 THEN Cast(LEFT(IsNull(A2.LicTradNum,''), CHARINDEX('-', IsNull(A2.LicTradNum,''))-1) As char(80)) ELSE Cast(IsNull(A2.LicTradNum,'') As char(80)) END +
						Cast(IsNull(J1.DocEntry,'') As char(80)) +
						Cast(IsNull(A0.NumAtCard,'') As Char(80)) As Cadena1,
						REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
						REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
						REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
						REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
						REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
						REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
						REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
						REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena2', A0.NumAtCard--, A0.DocEntry
						From OINV A0
						Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
						Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
						Inner Join OADM A3 On 1 = 1
						Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
						Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
						Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
						Inner Join (Select DISTINCT	MAX(A0.DocEntry) as DocEntry,		
						 A0.NumAtCard
						From OINV A0
						Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
						Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
						Inner Join OADM A3 On 1 = 1
						Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
						Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
						Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code			
						Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' 
						And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) &lt;= Month(GetDate()) /*And NumAtCard = '491'*/ Group By NumAtCard, DocDate, DocEntry ) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' --and A4.Code = '100'			
						Group by A0.NumAtCard
						 )	J1 ON J1.NumAtCard = A0.NumAtCard 
						Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' 
						And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) &lt;= Month(GetDate()) /*And NumAtCard = '491'*/ Group By NumAtCard, DocDate, DocEntry ) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' 
						Group By A3.U_EtyCode, A10.Name, A2.LicTradNum, J1.DocEntry, A0.NumAtCard
					) T1 On T0.Alumno = T1.NumAtCard
			) B0 Where Cadena &lt;&gt;''
)

Set @Conteo = 
(
	Select C0.Filas From 
	(
		Select Count(*) As Filas from 
		(
			Select 
			T1.Cadena1 + Cast(T0.TipoLin As Char(40)) + Cast(UPPER(T0.ItemName) as Char(80)) + '0' + Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
			REPLICATE('0', 18 - DATALENGTH(Replace(Cast(T0.LineTotal as numeric(16,2)),'.',''))) + Replace(Cast(T0.LineTotal as numeric(16,2)),'.','') +
			T1.Cadena2 As 'Cadena', T0.Alumno, T0.Orden
			From (

			Select ItemName, Round(Sum(LineTotal),0) 'LineTotal', Alumno, '00' As TipoLin, 2 Orden 
			From (
					Select
					'COSTOS EDUCATIVOS' + ' - ' + 
					Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
					Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')  ItemName, 
					A0.DocTotal - A0.PaidToDate 'LineTotal', A0.NumAtCard 'Alumno'
					From OINV A0
					Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
					Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
					Inner Join OADM A3 On 1 = 1
					Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
					Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
					Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
					Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And Year(A0.DocDate)  =  Year(GetDate()) And 
					A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) /*And NumAtCard = '491'*/) And A1.TargetType != '14' 
					Group By A0.DocTotal,A0.PaidToDate, A0.NumAtCard, A0.DocEntry, A4.U_SEINom, A4.U_SEICogn

					Union All

					Select ItemName, Sum(B0.Saldo)'LineTotal', B0.Alumno 
					From (
							Select 
							'COSTOS EDUCATIVOS' + ' - ' + 
							Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A3.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
							Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A3.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') ItemName, 
							(A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
							From OINV A0
							Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
							Left join OCRD A2 On A0.CardCode = A2.CardCode
							Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
							Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
							Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
							Inner Join OADM A6 On 1 = 1
							Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And Year(A0.DocDate)  =  Year(GetDate()) And 
							A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())) /*And A0.NumAtCard = '491'*/
							Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A3.U_SEINom, A3.U_SEICogn, A0.DocEntry
					) B0
					Group By B0.ItemName, B0.Alumno

					Union All

					Select ItemName, Sum(Saldo) 'LineTotal', Ref2'Alumno' From (
					Select 
					'COSTOS EDUCATIVOS' + ' - ' + 
					Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A5.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
					Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A5.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')  ItemName, 
					Sum(IsNull(A1.Debit,0))- Case When A4.Canceled = 'Y' Then 0 Else IsNull(Sum(A3.SumApplied),0) End 'Saldo', A0.Ref2, A0.TransId
					From OJDT A0 
					Inner Join JDT1 A1 On A0.TransId = A1.TransId 
					Left Join OINV A2 On A0.Ref1 = A2.DocNum 
					Left Join RCT2 A3 On A0.TransId = A3.DocEntry And A0.ObjType = A3.InvType 
					Left Join ORCT A4 On A3.DocNum = A4.DocEntry 
					Left Join [@SEI_ALUMNOS] A5 On IsNull(A2.NumAtCard,'') = A5.Code
					Left Join [@SEI_CURSOS] A6 On A5.U_SEICurso = A6.Code
					Left Join [@SEI_SRVCODE] A7 On A2.U_SEI_FACTU = A7.Code
					Inner Join OCRD A8 ON A2.CardCode = A8.CardCode
					Left Join OADM A9 On 1 = 1
					Where A0.TransCode = 'INT' And A2.U_SEI_FACTU = '1' And IsNull(A0.StornoToTr,'') = '' And A1.BalDueDeb &gt; 0 /*And A0.Ref2 = '491' */
					Group By A0.Ref2, A4.Canceled, A0.TransId, A5.U_SEINom, A5.U_SEICogn
					) C0 
					Where Saldo &gt; 0 And TransId Not In (Select StornoToTr From OJDT Where IsNull(StornoToTr,'') &lt;&gt; '')
					Group By Ref2, ItemName
			)P0
			Group By ItemName, Alumno

			Union All

			Select ItemName, Round(LineTotal,0) 'LineTotal', Alumno,'01' As TipoLin, 3 Orden 
			From (
					Select ItemName, Sum(B0.Saldo)'LineTotal', B0.Alumno 
					From (
							Select 
							'SALDO ANTERIOR' ItemName, (A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
							From OINV A0
							Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
							Left join OCRD A2 On A0.CardCode = A2.CardCode
							Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
							Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
							Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
							Inner Join OADM A6 On 1 = 1
							Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And Year(A0.DocDate)  =  Year(GetDate()) And
							A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())) /*And A0.NumAtCard = '491'*/
							Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A0.DocEntry
							union
							Select 
							'SALDO DEL MES ACTUAL' ItemName, (A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
							From OINV A0
							Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
							Left join OCRD A2 On A0.CardCode = A2.CardCode
							Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
							Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
							Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
							Inner Join OADM A6 On 1 = 1
							Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And IsNull(A0.PaidToDate,0) &gt; 0 And 
							A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())) /*And A0.NumAtCard = '491'*/
							Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A0.DocEntry
					) B0
					Group By B0.ItemName, B0.Alumno

					Union All

					Select ItemName, Sum(Saldo) 'LineTotal', Ref2'Alumno' 
					From 
					(
						Select 
						'INTERESES DEL MES' ItemName,
						Sum(IsNull(A1.Debit,0)) - Case When A4.Canceled = 'Y' Then 0 Else (Sum(IsNull(A1.Debit,0)) - IsNull(Sum(A1.BalDueDeb),0)) End 'Saldo', A0.Ref2, A0.TransId
						From OJDT A0 
						Inner Join JDT1 A1 On A0.TransId = A1.TransId 
						Left Join OINV A2 On A0.Ref1 = A2.DocNum 
						Left Join RCT2 A3 On A0.TransId = A3.DocEntry And A0.ObjType = A3.InvType 
						Left Join ORCT A4 On A3.DocNum = A4.DocEntry 
						Left Join [@SEI_ALUMNOS] A5 On IsNull(A2.NumAtCard,'') = A5.Code
						Left Join [@SEI_CURSOS] A6 On A5.U_SEICurso = A6.Code
						Left Join [@SEI_SRVCODE] A7 On A2.U_SEI_FACTU = A7.Code
						Inner Join OCRD A8 ON A2.CardCode = A8.CardCode
						Left Join OADM A9 On 1 = 1
						Where A0.TransCode = 'INT' And A2.U_SEI_FACTU = '1' And IsNull(A0.StornoToTr,'') = '' And A1.BalDueDeb &gt; 0 /*And A0.Ref2 = '491' */
						Group By A0.Ref2, A4.Canceled, A0.TransId
					) C0 
					Where Saldo &gt; 0 And TransId Not In (Select StornoToTr From OJDT Where IsNull(StornoToTr,'') &lt;&gt; '')
					Group By Ref2, ItemName

					Union All

					Select * 
					From 
					(
						Select
						A1.Dscription'ItemName', Cast(A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 as numeric(16,2)) 'LineTotal', A0.NumAtCard 'Alumno'
						From OINV A0
						Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
						Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
						Inner Join OADM A3 On 1 = 1
						Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
						Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
						Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc
						Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And IsNull(A0.PaidToDate,0) = 0
						And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) /*And NumAtCard = '491'*/) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' 
					)A0 Where A0.LineTotal &gt; 0
)P0
)T0
Left Join(
			Select
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			REPLICATE('0', 35 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') + 
			CASE WHEN CHARINDEX('-', IsNull(A2.LicTradNum,'')) &gt; 0 THEN Cast(LEFT(IsNull(A2.LicTradNum,''), CHARINDEX('-', IsNull(A2.LicTradNum,''))-1) As char(80)) ELSE Cast(IsNull(A2.LicTradNum,'') As char(80)) END +
			Cast(IsNull(J1.DocEntry,'') As char(80)) +
			Cast(IsNull(A0.NumAtCard,'') As Char(80)) As Cadena1,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena2', A0.NumAtCard--, A0.DocEntry
			From OINV A0
			Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Inner Join (Select DISTINCT	MAX(A0.DocEntry) as DocEntry,		
						 A0.NumAtCard
						From OINV A0
						Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
						Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
						Inner Join OADM A3 On 1 = 1
						Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
						Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
						Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code			
						Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' 
						And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) &lt;= Month(GetDate()) /*And NumAtCard = '491'*/ Group By NumAtCard, DocDate, DocEntry ) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' --and A4.Code = '100'			
						Group by A0.NumAtCard
						 )	J1 ON J1.NumAtCard = A0.NumAtCard 
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' 
			And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) &lt;= Month(GetDate()) /*And NumAtCard = '491'*/ Group By NumAtCard, DocDate, DocEntry ) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' 
			Group By A3.U_EtyCode, A10.Name, A2.LicTradNum, J1.DocEntry, A0.NumAtCard
		) T1 On T0.Alumno = T1.NumAtCard
		) B0 Where Cadena &lt;&gt;''
	) C0
)

/*Cabecera Archivo*/
Select Cadena From (
Select C0.* From (
Select
'1' +
Convert(VARCHAR(8), GetDate(), 112) +
REPLICATE('0', 6 - DATALENGTH(LTRIM(@Conteo))) + LTRIM(@Conteo) +
REPLICATE('0', 18 - DATALENGTH(Replace(Cast(@Valor as numeric(16,2)),'.',''))) + Replace(Cast(@Valor as numeric(16,2)),'.','') +
@Consec +
Space(527) As Cadena, 0 As Alumno, 1 As Orden
)C0

Union All

Select 
T1.Cadena1 + Cast(T0.TipoLin As Char(40)) + Cast(UPPER(T0.ItemName) as Char(80)) + '0' + Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
REPLICATE('0', 18 - DATALENGTH(Replace(Cast(T0.LineTotal as numeric(16,2)),'.',''))) + Replace(Cast(T0.LineTotal as numeric(16,2)),'.','') +
T1.Cadena2 As 'Cadena', T0.Alumno, T0.Orden
From (

Select ItemName, Round(Sum(LineTotal),0) LineTotal, Alumno, '00' As TipoLin, 2 Orden 
From (
		Select
		'COSTOS EDUCATIVOS' + ' - ' + 
		Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
		Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')  ItemName, 
		A0.DocTotal - A0.PaidToDate 'LineTotal', A0.NumAtCard 'Alumno'
		From OINV A0
		Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
		Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
		Inner Join OADM A3 On 1 = 1
		Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
		Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
		Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
		Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And Year(A0.DocDate)  =  Year(GetDate()) And 
		A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) /*And NumAtCard = '491'*/) And A1.TargetType != '14' 
		Group By A0.DocTotal, A0.PaidToDate, A0.NumAtCard, A0.DocEntry, A4.U_SEINom, A4.U_SEICogn

		Union All

		Select ItemName, Sum(B0.Saldo)'LineTotal', B0.Alumno 
		From (
				Select 
				'COSTOS EDUCATIVOS' + ' - ' + 
				Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A3.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
				Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A3.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') ItemName, 
				(A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
				From OINV A0
				Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
				Left join OCRD A2 On A0.CardCode = A2.CardCode
				Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
				Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
				Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
				Inner Join OADM A6 On 1 = 1
				Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And Year(A0.DocDate)  =  Year(GetDate()) And 
				A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())) /*And A0.NumAtCard = '491'*/
				Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A3.U_SEINom, A3.U_SEICogn, A0.DocEntry
		) B0
		Group By B0.ItemName, B0.Alumno

		Union All

		Select ItemName, Sum(Saldo) 'LineTotal', Ref2'Alumno' From (
		Select 
		'COSTOS EDUCATIVOS' + ' - ' + 
		Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A5.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
		Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A5.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')  ItemName, 
		Sum(IsNull(A1.Debit,0))- Case When A4.Canceled = 'Y' Then 0 Else (Sum(IsNull(A1.Debit,0)) - IsNull(Sum(A1.BalDueDeb),0)) End 'Saldo', A0.Ref2, A0.TransId
		From OJDT A0 
		Inner Join JDT1 A1 On A0.TransId = A1.TransId 
		Left Join OINV A2 On A0.Ref1 = A2.DocNum 
		Left Join RCT2 A3 On A0.TransId = A3.DocEntry And A0.ObjType = A3.InvType 
		Left Join ORCT A4 On A3.DocNum = A4.DocEntry 
		Left Join [@SEI_ALUMNOS] A5 On IsNull(A2.NumAtCard,'') = A5.Code
		Left Join [@SEI_CURSOS] A6 On A5.U_SEICurso = A6.Code
		Left Join [@SEI_SRVCODE] A7 On A2.U_SEI_FACTU = A7.Code
		Inner Join OCRD A8 ON A2.CardCode = A8.CardCode
		Left Join OADM A9 On 1 = 1
		Where A0.TransCode = 'INT' And A2.U_SEI_FACTU = '1' And IsNull(A0.StornoToTr,'') = '' And A1.BalDueDeb &gt; 0 /*And A0.Ref2 = '491' */
		Group By A0.Ref2, A4.Canceled, A0.TransId, A5.U_SEINom, A5.U_SEICogn
		) C0 
		Where Saldo &gt; 0 And TransId Not In (Select StornoToTr From OJDT Where IsNull(StornoToTr,'') &lt;&gt; '')
		Group By Ref2, ItemName
)P0
Group By ItemName, Alumno

Union All

Select ItemName, Round(LineTotal,0)'LineTotal', Alumno,'01' As TipoLin, 3 Orden 
From (
		Select ItemName, Sum(B0.Saldo)'LineTotal', B0.Alumno 
		From (
				Select 
				'SALDO ANTERIOR' ItemName, (A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
				From OINV A0
				Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
				Left join OCRD A2 On A0.CardCode = A2.CardCode
				Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
				Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
				Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
				Inner Join OADM A6 On 1 = 1
				Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And Year(A0.DocDate)  =  Year(GetDate()) And
				A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())) /*And A0.NumAtCard = '491'*/
				Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A0.DocEntry
				Union
				Select 
				'SALDO DEL MES ACTUAL' ItemName, (A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
				From OINV A0
				Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
				Left join OCRD A2 On A0.CardCode = A2.CardCode
				Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
				Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
				Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
				Inner Join OADM A6 On 1 = 1
				Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And IsNull(A0.PaidToDate,0) &gt; 0 And
				A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()))
				Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A0.DocEntry
		) B0
		Group By B0.ItemName, B0.Alumno

		Union All

		Select ItemName, Sum(Saldo) 'LineTotal', Ref2'Alumno' 
		From 
		(
			Select 
			'INTERESES DEL MES' ItemName,
			Sum(IsNull(A1.Debit,0)) - Case When A4.Canceled = 'Y' Then 0 Else (Sum(IsNull(A1.Debit,0)) - IsNull(Sum(A1.BalDueDeb),0)) End 'Saldo', A0.Ref2, A0.TransId
			From OJDT A0 
			Inner Join JDT1 A1 On A0.TransId = A1.TransId 
			Left Join OINV A2 On A0.Ref1 = A2.DocNum 
			Left Join RCT2 A3 On A0.TransId = A3.DocEntry And A0.ObjType = A3.InvType 
			Left Join ORCT A4 On A3.DocNum = A4.DocEntry 
			Left Join [@SEI_ALUMNOS] A5 On IsNull(A2.NumAtCard,'') = A5.Code
			Left Join [@SEI_CURSOS] A6 On A5.U_SEICurso = A6.Code
			Left Join [@SEI_SRVCODE] A7 On A2.U_SEI_FACTU = A7.Code
			Inner Join OCRD A8 ON A2.CardCode = A8.CardCode
			Left Join OADM A9 On 1 = 1
			Where A0.TransCode = 'INT' And A2.U_SEI_FACTU = '1' And IsNull(A0.StornoToTr,'') = '' And A1.BalDueDeb &gt; 0 /*And A0.Ref2 = '491' */
			Group By A0.Ref2, A4.Canceled, A0.TransId
		) C0 
		Where Saldo &gt; 0 And TransId Not In (Select StornoToTr From OJDT Where IsNull(StornoToTr,'') &lt;&gt; '')
		Group By Ref2, ItemName

		Union All

		Select * 
		From 
		(
			Select
			A1.Dscription'ItemName', Cast(A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 as numeric(16,2)) 'LineTotal', A0.NumAtCard 'Alumno'
			From OINV A0
			Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And IsNull(A0.PaidToDate,0) = 0
			And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) /*And NumAtCard = '491'*/) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' 
		)A0 Where A0.LineTotal &gt; 0
)P0
)T0
Left Join(
			Select 
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			REPLICATE('0', 35 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') + 
			CASE WHEN CHARINDEX('-', IsNull(A2.LicTradNum,'')) &gt; 0 THEN Cast(LEFT(IsNull(A2.LicTradNum,''), CHARINDEX('-', IsNull(A2.LicTradNum,''))-1) As char(80)) ELSE Cast(IsNull(A2.LicTradNum,'') As char(80)) END +
			Cast(IsNull(J1.DocEntry,'') As char(80)) +
			Cast(IsNull(A0.NumAtCard,'') As Char(80)) As Cadena1,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena2', A0.NumAtCard--, A0.DocEntry
			From OINV A0
			Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Inner Join (Select DISTINCT	MAX(A0.DocEntry) as DocEntry,		
			 A0.NumAtCard
			From OINV A0
			Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code			
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And Year(A0.DocDate)  =  Year(GetDate()) 
			And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) &lt;= Month(GetDate()) /*And NumAtCard = '491'*/ Group By NumAtCard, DocDate, DocEntry ) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' --and A4.Code = '100'			
			Group by A0.NumAtCard
			 )	J1 ON J1.NumAtCard = A0.NumAtCard 
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And Year(A0.DocDate)  =  Year(GetDate()) 
			And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) &lt; = Month(GetDate()) /*And NumAtCard = '491'*/ Group By NumAtCard, DocDate, DocEntry ) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' 
			Group By A3.U_EtyCode, A10.Name, A2.LicTradNum, J1.DocEntry, A0.NumAtCard			
		) T1 On T0.Alumno = T1.NumAtCard
) B0 Where Cadena &lt;&gt;'' Order By Alumno, Orden</value>
  </data>
  <data name="CarteraPSE" xml:space="preserve">
    <value>Set @Valor =
(
	Select Sum(LineTotal) As Total from 
		(
			Select LineTotal,
			T1.Cadena1 + Cast(T0.TipoLin As Char(40)) + Cast(UPPER(T0.ItemName) as Char(80)) + '0' + Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
			REPLICATE('0', 18 - DATALENGTH(Replace(Cast(T0.LineTotal as numeric(16,2)),'.',''))) + Replace(Cast(T0.LineTotal as numeric(16,2)),'.','') +
			T1.Cadena2 As 'Cadena', T0.Alumno, T0.Orden
			From (

			Select ItemName, Round(Sum(LineTotal),0) LineTotal, Alumno, '00' As TipoLin, 2 Orden 
			From (
					Select
						'COSTOS EDUCATIVOS' + ' - ' + 
						Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
						Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')  ItemName, 
						A0.DocTotal - A0.PaidToDate 'LineTotal', A0.NumAtCard 'Alumno'
						From OINV A0
						Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
						Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
						Inner Join OADM A3 On 1 = 1
						Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
						Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
						Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
						Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And Year(A0.DocDate)  =  Year(GetDate()) And 
						A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())  and YEAR(DocDate) &gt; 2015 /*And NumAtCard = '491'*/) And A1.TargetType != '14' and YEAR(A0.DocDate) &gt; 2015
						Group By A0.DocTotal, A0.PaidToDate, A0.NumAtCard, A0.DocEntry, A4.U_SEINom, A4.U_SEICogn

						Union All

						Select ItemName, Sum(B0.Saldo)'LineTotal', B0.Alumno 
						From (
								Select 
								'COSTOS EDUCATIVOS' + ' - ' + 
								Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A3.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
								Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A3.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') ItemName, 
								(A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
								From OINV A0
								Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
								Left join OCRD A2 On A0.CardCode = A2.CardCode
								Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
								Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
								Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
								Inner Join OADM A6 On 1 = 1
								Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And Year(A0.DocDate)  =  Year(GetDate()) And 
								A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) and YEAR(DocDate) &gt; 2015) /*And A0.NumAtCard = '491'*/ and YEAR(A0.DocDate) &gt; 2015
								Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A3.U_SEINom, A3.U_SEICogn, A0.DocEntry
						) B0
						Group By B0.ItemName, B0.Alumno

						Union All

						Select ItemName, Sum(Saldo) 'LineTotal', Ref2'Alumno' From (
						Select 
						'COSTOS EDUCATIVOS' + ' - ' + 
						Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A5.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
						Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A5.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')  ItemName, 
						Sum(IsNull(A1.Debit,0))- Case When A4.Canceled = 'Y' Then 0 Else (Sum(IsNull(A1.Debit,0)) - IsNull(Sum(A1.BalDueDeb),0)) End 'Saldo', A0.Ref2, A0.TransId
						From OJDT A0 
						Inner Join JDT1 A1 On A0.TransId = A1.TransId 
						Left Join OINV A2 On A0.Ref1 = A2.DocNum 
						Left Join RCT2 A3 On A0.TransId = A3.DocEntry And A0.ObjType = A3.InvType 
						Left Join ORCT A4 On A3.DocNum = A4.DocEntry 
						Left Join [@SEI_ALUMNOS] A5 On IsNull(A2.NumAtCard,'') = A5.Code
						Left Join [@SEI_CURSOS] A6 On A5.U_SEICurso = A6.Code
						Left Join [@SEI_SRVCODE] A7 On A2.U_SEI_FACTU = A7.Code
						Inner Join OCRD A8 ON A2.CardCode = A8.CardCode AND A8.CardCode = A1.ShortName
						Left Join OADM A9 On 1 = 1
						Where A0.TransCode = 'INT' And A2.U_SEI_FACTU = '1' And IsNull(A0.StornoToTr,'') = '' And A1.BalDueDeb &gt; 0 /*And A0.Ref2 = '491' */ and YEAR(A2.DocDate) &gt; 2015
						Group By A0.Ref2, A4.Canceled, A0.TransId, A5.U_SEINom, A5.U_SEICogn
						) C0 
						Where Saldo &gt; 0 And TransId Not In (Select StornoToTr From OJDT Where IsNull(StornoToTr,'') &lt;&gt; '')
						Group By Ref2, ItemName
			)P0
			Group By ItemName, Alumno

			Union All

			Select ItemName, Round(LineTotal,0), Alumno,'01' As TipoLin, 3 Orden 
			From (
					Select ItemName, Sum(B0.Saldo)'LineTotal', B0.Alumno 
					From (
							Select 
								'SALDO ANTERIOR' ItemName, (A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
								From OINV A0
								Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
								Left join OCRD A2 On A0.CardCode = A2.CardCode
								Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
								Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
								Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
								Inner Join OADM A6 On 1 = 1
								Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And Year(A0.DocDate)  =  Year(GetDate()) And
								A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) and YEAR(DocDate) &gt; 2015) /*And A0.NumAtCard = '491'*/ and YEAR(A0.DocDate) &gt; 2015
								Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A0.DocEntry
								Union all
								Select 
								'SALDO DEL MES ACTUAL' ItemName, (A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
								From OINV A0
								Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
								Left join OCRD A2 On A0.CardCode = A2.CardCode
								Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
								Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
								Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
								Inner Join OADM A6 On 1 = 1
								Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And IsNull(A0.PaidToDate,0) &gt; 0 And
								A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) and YEAR(DocDate) &gt; 2015) and YEAR(A0.DocDate) &gt; 2015
								Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A0.DocEntry
						) B0
						Group By B0.ItemName, B0.Alumno

						Union All

						Select ItemName, Sum(Saldo) 'LineTotal', Ref2'Alumno' 
						From 
						(
							Select 
							'INTERESES DEL MES' ItemName,
							Sum(IsNull(A1.Debit,0)) - Case When A4.Canceled = 'Y' Then 0 Else (Sum(IsNull(A1.Debit,0)) - IsNull(Sum(A1.BalDueDeb),0)) End 'Saldo', A0.Ref2, A0.TransId
							From OJDT A0 
							Inner Join JDT1 A1 On A0.TransId = A1.TransId 
							--Inner join ocrd ll on a1.ShortName=ll.CardCode 
							Left Join OINV A2 On A0.Ref1 = A2.DocNum 
							Left Join RCT2 A3 On A0.TransId = A3.DocEntry And A0.ObjType = A3.InvType 
							Left Join ORCT A4 On A3.DocNum = A4.DocEntry 
							Left Join [@SEI_ALUMNOS] A5 On IsNull(A2.NumAtCard,'') = A5.Code
							Left Join [@SEI_CURSOS] A6 On A5.U_SEICurso = A6.Code
							Left Join [@SEI_SRVCODE] A7 On A2.U_SEI_FACTU = A7.Code
							Inner Join OCRD A8 ON A2.CardCode = A8.CardCode AND A8.CardCode = A1.ShortName
							Left Join OADM A9 On 1 = 1
							Where A0.TransCode = 'INT' And A2.U_SEI_FACTU = '1' And IsNull(A0.StornoToTr,'') = '' And A1.BalDueDeb &gt; 0 /*And A0.Ref2 = '100191'*/  and YEAR(A2.DocDate) &gt; 2015
							Group By A0.Ref2, A4.Canceled, A0.TransId
						) C0 
						Where Saldo &gt; 0 And TransId Not In (Select StornoToTr From OJDT Where IsNull(StornoToTr,'') &lt;&gt; '')
						Group By Ref2, ItemName

						Union All

						Select * 
						From 
						(
							Select distinct
							A1.Dscription'ItemName', Cast(A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 as numeric(16,2)) 'LineTotal', A0.NumAtCard 'Alumno'
							From OINV A0
							Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
							Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
							Inner Join OADM A3 On 1 = 1
							Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
							Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
							Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc
							Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And IsNull(A0.PaidToDate,0) = 0
							And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) and YEAR(DocDate) &gt; 2015 /*And NumAtCard = '491'*/) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' and YEAR(A0.DocDate) &gt; 2015
						)A0 Where A0.LineTotal &gt; 0
			)P0
			)T0
			Left Join(
			Select 
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			REPLICATE('0', 35 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') + 
			CASE WHEN CHARINDEX('-', IsNull(A2.LicTradNum,'')) &gt; 0 THEN Cast(LEFT(IsNull(A2.LicTradNum,''), CHARINDEX('-', IsNull(A2.LicTradNum,''))-1) As char(80)) ELSE Cast(IsNull(A2.LicTradNum,'') As char(80)) END +
			Cast(IsNull(J1.DocEntry,'') As char(80)) +
			Cast(IsNull(A0.NumAtCard,'') As Char(80)) As Cadena1,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena2', A0.NumAtCard--, A0.DocEntry
			From OINV A0
			Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Inner Join (Select DISTINCT	MAX(A0.DocEntry) as DocEntry,		
			 A0.NumAtCard
			From OINV A0
			Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code			
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And Year(A0.DocDate)  =  Year(GetDate()) 
			And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) &lt;= Month(GetDate()) and YEAR(DocDate) &gt; 2015 /*And NumAtCard = '491'*/ Group By NumAtCard, DocDate, DocEntry ) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' and YEAR(A0.DocDate) &gt; 2015 --and A4.Code = '100'			
			Group by A0.NumAtCard
			 )	J1 ON J1.NumAtCard = A0.NumAtCard 
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And Year(A0.DocDate)  =  Year(GetDate()) 
			And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) &lt; = Month(GetDate()) and YEAR(DocDate) &gt; 2015 /*And NumAtCard = '491'*/ Group By NumAtCard, DocDate, DocEntry ) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' and YEAR(A0.DocDate) &gt; 2015
			Group By A3.U_EtyCode, A10.Name, A2.LicTradNum, J1.DocEntry, A0.NumAtCard				
					) T1 On T0.Alumno = T1.NumAtCard
			) B0 Where Cadena &lt;&gt;''
)

Set @Conteo = 
(
	Select C0.Filas From 
	(
		Select Count(*) As Filas from 
		(
			Select 
			T1.Cadena1 + Cast(T0.TipoLin As Char(40)) + Cast(UPPER(T0.ItemName) as Char(80)) + '0' + Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
			REPLICATE('0', 18 - DATALENGTH(Replace(Cast(T0.LineTotal as numeric(16,2)),'.',''))) + Replace(Cast(T0.LineTotal as numeric(16,2)),'.','') +
			T1.Cadena2 As 'Cadena', T0.Alumno, T0.Orden
			From (

			Select ItemName, Round(Sum(LineTotal),0) 'LineTotal', Alumno, '00' As TipoLin, 2 Orden 
			From (
					Select
					'COSTOS EDUCATIVOS' + ' - ' + 
					Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
					Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')  ItemName, 
					A0.DocTotal - A0.PaidToDate 'LineTotal', A0.NumAtCard 'Alumno'
					From OINV A0
					Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
					Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
					Inner Join OADM A3 On 1 = 1
					Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
					Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
					Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
					Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And Year(A0.DocDate)  =  Year(GetDate()) And 
					A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())  and YEAR(DocDate) &gt; 2015 /*And NumAtCard = '491'*/) And A1.TargetType != '14' and YEAR(A0.DocDate) &gt; 2015
					Group By A0.DocTotal, A0.PaidToDate, A0.NumAtCard, A0.DocEntry, A4.U_SEINom, A4.U_SEICogn

					Union All

					Select ItemName, Sum(B0.Saldo)'LineTotal', B0.Alumno 
					From (
							Select 
							'COSTOS EDUCATIVOS' + ' - ' + 
							Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A3.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
							Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A3.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') ItemName, 
							(A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
							From OINV A0
							Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
							Left join OCRD A2 On A0.CardCode = A2.CardCode
							Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
							Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
							Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
							Inner Join OADM A6 On 1 = 1
							Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And Year(A0.DocDate)  =  Year(GetDate()) And 
							A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) and YEAR(DocDate) &gt; 2015) /*And A0.NumAtCard = '491'*/ and YEAR(A0.DocDate) &gt; 2015
							Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A3.U_SEINom, A3.U_SEICogn, A0.DocEntry
					) B0
					Group By B0.ItemName, B0.Alumno

					Union All

					Select ItemName, Sum(Saldo) 'LineTotal', Ref2'Alumno' From (
					Select 
					'COSTOS EDUCATIVOS' + ' - ' + 
					Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A5.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
					Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A5.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')  ItemName, 
					Sum(IsNull(A1.Debit,0))- Case When A4.Canceled = 'Y' Then 0 Else (Sum(IsNull(A1.Debit,0)) - IsNull(Sum(A1.BalDueDeb),0)) End 'Saldo', A0.Ref2, A0.TransId
					From OJDT A0 
					Inner Join JDT1 A1 On A0.TransId = A1.TransId 
					Left Join OINV A2 On A0.Ref1 = A2.DocNum 
					Left Join RCT2 A3 On A0.TransId = A3.DocEntry And A0.ObjType = A3.InvType 
					Left Join ORCT A4 On A3.DocNum = A4.DocEntry 
					Left Join [@SEI_ALUMNOS] A5 On IsNull(A2.NumAtCard,'') = A5.Code
					Left Join [@SEI_CURSOS] A6 On A5.U_SEICurso = A6.Code
					Left Join [@SEI_SRVCODE] A7 On A2.U_SEI_FACTU = A7.Code
					Inner Join OCRD A8 ON A2.CardCode = A8.CardCode AND A8.CardCode = A1.ShortName
					Left Join OADM A9 On 1 = 1
					Where A0.TransCode = 'INT' And A2.U_SEI_FACTU = '1' And IsNull(A0.StornoToTr,'') = '' And A1.BalDueDeb &gt; 0 /*And A0.Ref2 = '491' */ and YEAR(A2.DocDate) &gt; 2015
					Group By A0.Ref2, A4.Canceled, A0.TransId, A5.U_SEINom, A5.U_SEICogn
					) C0 
					Where Saldo &gt; 0 And TransId Not In (Select StornoToTr From OJDT Where IsNull(StornoToTr,'') &lt;&gt; '')
					Group By Ref2, ItemName
			)P0
			Group By ItemName, Alumno

			Union All

			Select ItemName, Round(LineTotal,0) 'LineTotal', Alumno,'01' As TipoLin, 3 Orden 
			From (
					Select ItemName, Sum(B0.Saldo)'LineTotal', B0.Alumno 
					From (
							Select 
								'SALDO ANTERIOR' ItemName, (A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
								From OINV A0
								Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
								Left join OCRD A2 On A0.CardCode = A2.CardCode
								Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
								Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
								Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
								Inner Join OADM A6 On 1 = 1
								Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And Year(A0.DocDate)  =  Year(GetDate()) And
								A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) and YEAR(DocDate) &gt; 2015) /*And A0.NumAtCard = '491'*/ and YEAR(A0.DocDate) &gt; 2015
								Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A0.DocEntry
								Union all
								Select 
								'SALDO DEL MES ACTUAL' ItemName, (A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
								From OINV A0
								Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
								Left join OCRD A2 On A0.CardCode = A2.CardCode
								Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
								Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
								Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
								Inner Join OADM A6 On 1 = 1
								Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And IsNull(A0.PaidToDate,0) &gt; 0 And
								A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) and YEAR(DocDate) &gt; 2015) and YEAR(A0.DocDate) &gt; 2015
								Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A0.DocEntry
						) B0
						Group By B0.ItemName, B0.Alumno

						Union All

						Select ItemName, Sum(Saldo) 'LineTotal', Ref2'Alumno' 
						From 
						(
							Select 
							'INTERESES DEL MES' ItemName,
							Sum(IsNull(A1.Debit,0)) - Case When A4.Canceled = 'Y' Then 0 Else (Sum(IsNull(A1.Debit,0)) - IsNull(Sum(A1.BalDueDeb),0)) End 'Saldo', A0.Ref2, A0.TransId
							From OJDT A0 
							Inner Join JDT1 A1 On A0.TransId = A1.TransId 
							--Inner join ocrd ll on a1.ShortName=ll.CardCode 
							Left Join OINV A2 On A0.Ref1 = A2.DocNum 
							Left Join RCT2 A3 On A0.TransId = A3.DocEntry And A0.ObjType = A3.InvType 
							Left Join ORCT A4 On A3.DocNum = A4.DocEntry 
							Left Join [@SEI_ALUMNOS] A5 On IsNull(A2.NumAtCard,'') = A5.Code
							Left Join [@SEI_CURSOS] A6 On A5.U_SEICurso = A6.Code
							Left Join [@SEI_SRVCODE] A7 On A2.U_SEI_FACTU = A7.Code
							Inner Join OCRD A8 ON A2.CardCode = A8.CardCode AND A8.CardCode = A1.ShortName
							Left Join OADM A9 On 1 = 1
							Where A0.TransCode = 'INT' And A2.U_SEI_FACTU = '1' And IsNull(A0.StornoToTr,'') = '' And A1.BalDueDeb &gt; 0 /*And A0.Ref2 = '100191'*/  and YEAR(A2.DocDate) &gt; 2015
							Group By A0.Ref2, A4.Canceled, A0.TransId
						) C0 
						Where Saldo &gt; 0 And TransId Not In (Select StornoToTr From OJDT Where IsNull(StornoToTr,'') &lt;&gt; '')
						Group By Ref2, ItemName

						Union All

						Select * 
						From 
						(
							Select distinct
							A1.Dscription'ItemName', Cast(A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 as numeric(16,2)) 'LineTotal', A0.NumAtCard 'Alumno'
							From OINV A0
							Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
							Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
							Inner Join OADM A3 On 1 = 1
							Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
							Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
							Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc
							Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And IsNull(A0.PaidToDate,0) = 0
							And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) and YEAR(DocDate) &gt; 2015 /*And NumAtCard = '491'*/) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' and YEAR(A0.DocDate) &gt; 2015
						)A0 Where A0.LineTotal &gt; 0
)P0
)T0
Left Join(
			Select 
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			REPLICATE('0', 35 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') + 
			CASE WHEN CHARINDEX('-', IsNull(A2.LicTradNum,'')) &gt; 0 THEN Cast(LEFT(IsNull(A2.LicTradNum,''), CHARINDEX('-', IsNull(A2.LicTradNum,''))-1) As char(80)) ELSE Cast(IsNull(A2.LicTradNum,'') As char(80)) END +
			Cast(IsNull(J1.DocEntry,'') As char(80)) +
			Cast(IsNull(A0.NumAtCard,'') As Char(80)) As Cadena1,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena2', A0.NumAtCard--, A0.DocEntry
			From OINV A0
			Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Inner Join (Select DISTINCT	MAX(A0.DocEntry) as DocEntry,		
			 A0.NumAtCard
			From OINV A0
			Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code			
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And Year(A0.DocDate)  =  Year(GetDate()) 
			And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) &lt;= Month(GetDate()) and YEAR(DocDate) &gt; 2015 /*And NumAtCard = '491'*/ Group By NumAtCard, DocDate, DocEntry ) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' and YEAR(A0.DocDate) &gt; 2015 --and A4.Code = '100'			
			Group by A0.NumAtCard
			 )	J1 ON J1.NumAtCard = A0.NumAtCard 
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And Year(A0.DocDate)  =  Year(GetDate()) 
			And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) &lt; = Month(GetDate()) and YEAR(DocDate) &gt; 2015 /*And NumAtCard = '491'*/ Group By NumAtCard, DocDate, DocEntry ) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' and YEAR(A0.DocDate) &gt; 2015
			Group By A3.U_EtyCode, A10.Name, A2.LicTradNum, J1.DocEntry, A0.NumAtCard			
		) T1 On T0.Alumno = T1.NumAtCard
		) B0 Where Cadena &lt;&gt;''
	) C0
)

/*Cabecera Archivo*/
Select Cadena From (
Select C0.* From (
Select
'1' +
Convert(VARCHAR(8), GetDate(), 112) +
REPLICATE('0', 6 - DATALENGTH(LTRIM(@Conteo))) + LTRIM(@Conteo) +
REPLICATE('0', 18 - DATALENGTH(Replace(Cast(@Valor as numeric(16,2)),'.',''))) + Replace(Cast(@Valor as numeric(16,2)),'.','') +
@Consec +
Space(527) As Cadena, 0 As Alumno, 1 As Orden
)C0

Union All

Select 
T1.Cadena1 + Cast(T0.TipoLin As Char(40)) + Cast(UPPER(T0.ItemName) as Char(80)) + '0' + Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
REPLICATE('0', 18 - DATALENGTH(Replace(Cast(T0.LineTotal as numeric(16,2)),'.',''))) + Replace(Cast(T0.LineTotal as numeric(16,2)),'.','') +
T1.Cadena2 As 'Cadena', T0.Alumno, T0.Orden
From (

Select ItemName, Round(Sum(LineTotal),0) LineTotal, Alumno, '00' As TipoLin, 2 Orden 
From (
		Select
		'COSTOS EDUCATIVOS' + ' - ' + 
		Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
		Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')  ItemName, 
		A0.DocTotal - A0.PaidToDate 'LineTotal', A0.NumAtCard 'Alumno'
		From OINV A0
		Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
		Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
		Inner Join OADM A3 On 1 = 1
		Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
		Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
		Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
		Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And Year(A0.DocDate)  =  Year(GetDate()) And 
		A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())  and YEAR(DocDate) &gt; 2015 /*And NumAtCard = '491'*/) And A1.TargetType != '14' and YEAR(A0.DocDate) &gt; 2015
		Group By A0.DocTotal, A0.PaidToDate, A0.NumAtCard, A0.DocEntry, A4.U_SEINom, A4.U_SEICogn

		Union All

		Select ItemName, Sum(B0.Saldo)'LineTotal', B0.Alumno 
		From (
				Select 
				'COSTOS EDUCATIVOS' + ' - ' + 
				Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A3.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
				Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A3.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') ItemName, 
				(A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
				From OINV A0
				Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
				Left join OCRD A2 On A0.CardCode = A2.CardCode
				Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
				Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
				Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
				Inner Join OADM A6 On 1 = 1
				Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And Year(A0.DocDate)  =  Year(GetDate()) And 
				A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) and YEAR(DocDate) &gt; 2015) /*And A0.NumAtCard = '491'*/ and YEAR(A0.DocDate) &gt; 2015
				Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A3.U_SEINom, A3.U_SEICogn, A0.DocEntry
		) B0
		Group By B0.ItemName, B0.Alumno

		Union All

		Select ItemName, Sum(Saldo) 'LineTotal', Ref2'Alumno' From (
		Select 
		'COSTOS EDUCATIVOS' + ' - ' + 
		Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A5.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
		Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A5.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')  ItemName, 
		Sum(IsNull(A1.Debit,0))- Case When A4.Canceled = 'Y' Then 0 Else (Sum(IsNull(A1.Debit,0)) - IsNull(Sum(A1.BalDueDeb),0)) End 'Saldo', A0.Ref2, A0.TransId
		From OJDT A0 
		Inner Join JDT1 A1 On A0.TransId = A1.TransId 
		Left Join OINV A2 On A0.Ref1 = A2.DocNum 
		Left Join RCT2 A3 On A0.TransId = A3.DocEntry And A0.ObjType = A3.InvType 
		Left Join ORCT A4 On A3.DocNum = A4.DocEntry 
		Left Join [@SEI_ALUMNOS] A5 On IsNull(A2.NumAtCard,'') = A5.Code
		Left Join [@SEI_CURSOS] A6 On A5.U_SEICurso = A6.Code
		Left Join [@SEI_SRVCODE] A7 On A2.U_SEI_FACTU = A7.Code
		Inner Join OCRD A8 ON A2.CardCode = A8.CardCode AND A8.CardCode = A1.ShortName
		Left Join OADM A9 On 1 = 1
		Where A0.TransCode = 'INT' And A2.U_SEI_FACTU = '1' And IsNull(A0.StornoToTr,'') = '' And A1.BalDueDeb &gt; 0 /*And A0.Ref2 = '491' */ and YEAR(A2.DocDate) &gt; 2015
		Group By A0.Ref2, A4.Canceled, A0.TransId, A5.U_SEINom, A5.U_SEICogn
		) C0 
		Where Saldo &gt; 0 And TransId Not In (Select StornoToTr From OJDT Where IsNull(StornoToTr,'') &lt;&gt; '')
		Group By Ref2, ItemName
)P0
Group By ItemName, Alumno

Union All

Select ItemName, Round(LineTotal,0)'LineTotal', Alumno,'01' As TipoLin, 3 Orden 
From (
		Select ItemName, Sum(B0.Saldo)'LineTotal', B0.Alumno 
		From (
				Select 
				'SALDO ANTERIOR' ItemName, (A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
				From OINV A0
				Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
				Left join OCRD A2 On A0.CardCode = A2.CardCode
				Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
				Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
				Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
				Inner Join OADM A6 On 1 = 1
				Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And Year(A0.DocDate)  =  Year(GetDate()) And
				A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) and YEAR(DocDate) &gt; 2015) /*And A0.NumAtCard = '491'*/ and YEAR(A0.DocDate) &gt; 2015
				Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A0.DocEntry
				Union all
				Select 
				'SALDO DEL MES ACTUAL' ItemName, (A0.DocTotal-IsNull(A0.PaidToDate,0)) 'Saldo', A0.NumAtCard 'Alumno'
				From OINV A0
				Left Join INV1 A1 On A0.DocEntry = A1.DocEntry
				Left join OCRD A2 On A0.CardCode = A2.CardCode
				Left Join [@SEI_ALUMNOS] A3 On IsNull(A0.NumAtCard,'')= A3.Code
				Left Join [@SEI_CURSOS] A4 On A3.U_SEICurso = A4.Code
				Left Join [@SEI_SRVCODE] A5 On A0.U_SEI_FACTU = A5.Code
				Inner Join OADM A6 On 1 = 1
				Where A0.DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And A1.TargetType != '14' And IsNull(A0.PaidToDate,0) &gt; 0 And
				A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) and YEAR(DocDate) &gt; 2015) and YEAR(A0.DocDate) &gt; 2015
				Group By A0.NumAtCard, A0.DocTotal, A0.PaidToDate, A0.DocEntry
		) B0
		Group By B0.ItemName, B0.Alumno

		Union All

		Select ItemName, Sum(Saldo) 'LineTotal', Ref2'Alumno' 
		From 
		(
			Select 
			'INTERESES DEL MES' ItemName,
			Sum(IsNull(A1.Debit,0)) - Case When A4.Canceled = 'Y' Then 0 Else (Sum(IsNull(A1.Debit,0)) - IsNull(Sum(A1.BalDueDeb),0)) End 'Saldo', A0.Ref2, A0.TransId
			From OJDT A0 
			Inner Join JDT1 A1 On A0.TransId = A1.TransId 
			--Inner join ocrd ll on a1.ShortName=ll.CardCode 
			Left Join OINV A2 On A0.Ref1 = A2.DocNum 
			Left Join RCT2 A3 On A0.TransId = A3.DocEntry And A0.ObjType = A3.InvType 
			Left Join ORCT A4 On A3.DocNum = A4.DocEntry 
			Left Join [@SEI_ALUMNOS] A5 On IsNull(A2.NumAtCard,'') = A5.Code
			Left Join [@SEI_CURSOS] A6 On A5.U_SEICurso = A6.Code
			Left Join [@SEI_SRVCODE] A7 On A2.U_SEI_FACTU = A7.Code
			Inner Join OCRD A8 ON A2.CardCode = A8.CardCode AND A8.CardCode = A1.ShortName
			Left Join OADM A9 On 1 = 1
			Where A0.TransCode = 'INT' And A2.U_SEI_FACTU = '1' And IsNull(A0.StornoToTr,'') = '' And A1.BalDueDeb &gt; 0 /*And A0.Ref2 = '100191'*/  and YEAR(A2.DocDate) &gt; 2015
			Group By A0.Ref2, A4.Canceled, A0.TransId
		) C0 
		Where Saldo &gt; 0 And TransId Not In (Select StornoToTr From OJDT Where IsNull(StornoToTr,'') &lt;&gt; '')
		Group By Ref2, ItemName

		Union All

		Select * 
		From 
		(
			Select distinct
			A1.Dscription'ItemName', Cast(A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 as numeric(16,2)) 'LineTotal', A0.NumAtCard 'Alumno'
			From OINV A0
			Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And IsNull(A0.PaidToDate,0) = 0
			And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) and YEAR(DocDate) &gt; 2015 /*And NumAtCard = '491'*/) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' and YEAR(A0.DocDate) &gt; 2015
		)A0 Where A0.LineTotal &gt; 0
)P0
)T0
Left Join(
			Select 
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			REPLICATE('0', 35 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') + 
			CASE WHEN CHARINDEX('-', IsNull(A2.LicTradNum,'')) &gt; 0 THEN Cast(LEFT(IsNull(A2.LicTradNum,''), CHARINDEX('-', IsNull(A2.LicTradNum,''))-1) As char(80)) ELSE Cast(IsNull(A2.LicTradNum,'') As char(80)) END +
			Cast(IsNull(J1.DocEntry,'') As char(80)) +
			Cast(IsNull(A0.NumAtCard,'') As Char(80)) As Cadena1,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena2', A0.NumAtCard--, A0.DocEntry
			From OINV A0
			Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Inner Join (Select DISTINCT	MAX(A0.DocEntry) as DocEntry,		
			 A0.NumAtCard
			From OINV A0
			Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code			
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And Year(A0.DocDate)  =  Year(GetDate()) 
			And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) &lt;= Month(GetDate()) and YEAR(DocDate) &gt; 2015 /*And NumAtCard = '491'*/ Group By NumAtCard, DocDate, DocEntry ) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' and YEAR(A0.DocDate) &gt; 2015 --and A4.Code = '100'			
			Group by A0.NumAtCard
			 )	J1 ON J1.NumAtCard = A0.NumAtCard 
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 1 And A0.U_SEI_FACTU = '1' And Year(A0.DocDate)  =  Year(GetDate()) 
			And A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) &lt; = Month(GetDate()) and YEAR(DocDate) &gt; 2015 /*And NumAtCard = '491'*/ Group By NumAtCard, DocDate, DocEntry ) /*And A0.NumAtCard = '491'*/ And A1.TargetType != '14' and YEAR(A0.DocDate) &gt; 2015
			Group By A3.U_EtyCode, A10.Name, A2.LicTradNum, J1.DocEntry, A0.NumAtCard			
		) T1 On T0.Alumno = T1.NumAtCard
) B0 Where Cadena &lt;&gt;'' Order By Alumno, Orden</value>
  </data>
  <data name="CDT" xml:space="preserve">
    <value>Select 'CDU026NUMO'As 'NO TOCAR','CDU026NIDE' As 'NO TOCAR','CDU026NCLI'As 'NO TOCAR','CDU026TICC' As 'NO TOCAR','CDU026NRCC' As 'NO TOCAR',
'CDU026NITB'As 'NIT DEL CLIENTE RECEPTOR','CDU026NOMB' As 'NOMBRE DEL CLIENTE RECEPTOR','CDU026BANB' As 'CODIGO BANCO',
'CDU026TIPC' As '1= CTA CTE / 2= CTA AHOR','CDU026NRCB' As 'NUMERO DE CUENTA','CDU026CLAM' As 'NO TOCAR','CDU026VLRB' As 'VALOR SIN DECIMALES'
Union All
Select
Cast(Row_number() over (ORDER BY A2.LicTradNum) As nvarchar(40)) As 'NO TOCAR',
'' As 'NO TOCAR',
'BANCO COLPATRIA S.A' As 'NO TOCAR',
'6' As 'NO TOCAR',
'' As 'NO TOCAR',
Replace(IsNull(A2.LicTradNum,''),'-','') As 'NIT DEL CLIENTE RECEPTOR',
A2.CardName As 'NOMBRE DEL CLIENTE RECEPTOR',
Cast(Cast(IsNull(A2.BankCode,'') as Int) As Nvarchar(20)) As 'CODIGO BANCO',
Case when A2.DflIBAN = '01' Then '1' When A2.DflIBAN = '02' Then '2' Else '' End As '1= CTA CTE / 2= CTA AHOR',
Cast(IsNull(Cast(A2.DflAccount As Nvarchar(500)),'') As Nvarchar(50)) As 'NUMERO DE CUENTA',
'' As 'NO TOCAR',
Replace(Cast(IsNull(Sum(A0.TrsfrSum),0) As Numeric(15,0)),'.','') As 'VALOR SIN DECIMALES'
From OVPM A0
Left Join OCRD A2 On A0.CardCode = A2.CardCode
Left Join OPYM A3 On A0.PayMth = A3.PayMethCod
Left Join DSC1 A5 On A0.TrsfrAcct = A5.GLAccount
Left Join [@BPCO_TD] A6 On A2.U_BPCO_TDC = A6.Code
Where A0.DocDate = @FechaArchivo And (IsNull(A3.PayMethCod,'') Like '%CDT%' Or A0.U_METOPAGO = 'CDT') And Cast(IsNull(A2.BankCode,'') As Int) = '19'
Group By A2.LicTradNum, A2.CardName, A2.BankCode, A2.DflIBAN, A2.DflAccount</value>
  </data>
  <data name="Colpatria" xml:space="preserve">
    <value>Set @Conteo =
(
	Select C0.Filas From 
	(
		Select Count(*) As Filas from 
		(
			Select
			REPLICATE('0', 5 - Len(Cast(Row_number() over (ORDER BY A1.DocEntry) + 1 As nvarchar(40)))) + Cast(Row_number() over (ORDER BY A1.DocEntry) + 1 As nvarchar(40)) As REGISTRO,
			'02' As TIPO_REGISTRO,
			REPLICATE('0', 12 - Len(IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0'))) + IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0') As NUMERO_CUENTA,
			REPLICATE('0', 11 - Len(Replace(IsNull(A2.LicTradNum,''), '-', ''))) + Replace(IsNull(A2.LicTradNum,''), '-', '') As NIT_BENEFICIARIO,
			Cast(A2.CardName As Char (40)) As NOMBRE_BENEFICIARIO,
			'901' As CODIGO_TRANSACCION,
			'01' As TIPO_CARGO,
			REPLICATE('0', 17 - Len(Replace(Cast(A1.SumApplied As Numeric(15,2)),'.',''))) + Replace(Cast(A1.SumApplied As Numeric(15,2)),'.','') As VALOR_NETO,
			Cast(A1.DocEntry As Char (10)) As NUMERO_FACTURA,
			'000000' As NUMERO_CONTROL_PAGO,
			REPLICATE('0', 17 - Len(Replace(Cast(A1.WtAppld As Numeric(15,2)),'.',''))) + Replace(Cast(A1.WtAppld As Numeric(15,2)),'.','') As VALOR_RETENCION ,
			REPLICATE('0', 17 - Len(Replace(Cast(A1.ExpVatSum As Numeric(15,2)),'.',''))) + Replace(Cast(A1.ExpVatSum As Numeric(15,2)),'.','') As VALOR_IVA,
			REPLACE(CONVERT(CHAR(10), A0.DocDate, 103), '/', '') As FECHA_PAGO,
			'0000000000' As NUMERO_NOTA_DEBITO,
			'000000000000000' As VALOR_NOTA_DEBITO,
			REPLICATE('0', 8 - Len(IsNull(Cast(Replace(A2.BankCode,'-','0') As Nvarchar(500)),'0'))) + IsNull(Cast(Replace(A2.BankCode,'-','0') As Nvarchar(500)),'0') As CODIGO_BANCO,
			REPLICATE('0', 17 - Len(IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0'))) + IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0') As NUMERO_CUENTA_ABONO,
			Case When A2.DflIBAN = '01' Then '1' When A2.DflIBAN = '02' Then '2' Else '00' End CLASE_CUENTA,
			Case 
				When A6.U_TicpoDocICA = 'NIT' Then 'N' 
				When A6.U_TicpoDocICA = 'CC' Then 'C' 
				When A6.U_TicpoDocICA = 'PA' Then 'P' 
				When A6.U_TicpoDocICA = 'TI' Then 'I'
				When A6.U_TicpoDocICA = 'CE' Then 'E'
				Else A6.U_TicpoDocICA
			End TIPO_DOCUMENTO,
			Cast('' As Char (80)) As ADENDA,
			'' As MOTIVO_RECHAZO
			From OVPM A0
			Left join VPM2 A1 On A0.DocEntry = A1.DocNum
			Left Join OCRD A2 On A0.CardCode = A2.CardCode
			Left Join OPYM A3 On A0.PayMth = A3.PayMethCod
			Left Join DSC1 A5 On A0.TrsfrAcct = A5.GLAccount
			Left Join [@BPCO_TD] A6 On A2.U_BPCO_TDC = A6.Code
			Where A0.DocDate = @FechaArchivo And IsNull(A0.CheckSum,0) = 0 And IsNull(A0.CashSum,0) = 0 And (A3.PayMethCod Like '%Trans%' Or A0.U_METOPAGO = 'Trans')
		)P0
	) C0
)
--/*Cabecera Archivo*/
Select (
Select
'00001'REGISTRO,
'01' As TIPO_REGISTRO,
--REPLACE(CONVERT(CHAR(10), @FechaArchivo, 103), '/', '') As FECHA_RECIBO,
REPLICATE('0', 11 - Len(Replace(IsNull(A4.TaxIdNum,''), '-', ''))) + Replace(IsNull(A4.TaxIdNum,''), '-', '') As NIT_CLIENTE,
Cast(IsNull(A3.SwiftNum,'') As Char(10)) As CLAVE,
--REPLICATE('0', 6 - Len(LTRIM(@Conteo+2))) + LTRIM(@Conteo+2) As REGISTROS_ENVIADOS,
'2' As TIPO_CARGO,
REPLICATE('0', 4 - Len(IsNull(A3.Street,''))) + IsNull(A3.Street,'') As OFICINA_PAGO,
REPLICATE('0', 12 - Len(IsNull(A1.DflAccount,''))) + IsNull(A1.DflAccount,'') As NUMERO_CUENTA,
'0' As RESULTADO_VALIDACION,
'0' As NUMERO_LOTE,
'' As MOTIVO_RECHAZO,
'0' As ID_PROCESO, 
'' As USUARIO
From OVPM A0
Left Join OPYM A1 On A0.PayMth = A1.PayMethCod
Left Join ODSC A2 On A1.BnkDflt = A2.BankCode
Left Join DSC1 A3 On A2.DfltActKey = A3.AbsEntry
Left join OADM A4 On 1 = 1
Where A0.DocDate = @FechaArchivo And IsNull(A0.CheckSum,0) = 0 And IsNull(A0.CashSum,0) = 0 And (A1.PayMethCod Like '%Trans%' Or A0.U_METOPAGO = 'Trans')
Group By A3.Street, A1.DflAccount, A4.TaxIdNum, A3.SwiftNum
FOR XML RAW ('ENCABEZADO') , TYPE
),
(
Select
REPLICATE('0', 5 - Len(Cast(Row_number() over (ORDER BY A1.DocEntry) + 1 As nvarchar(40)))) + Cast(Row_number() over (ORDER BY A1.DocEntry) + 1 As nvarchar(40)) As REGISTRO,
'02' As TIPO_REGISTRO,
REPLICATE('0', 12 - Len(IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0'))) + IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0') As NUMERO_CUENTA,
REPLICATE('0', 11 - Len(Replace(IsNull(A2.LicTradNum,''), '-', ''))) + Replace(IsNull(A2.LicTradNum,''), '-', '') As NIT_BENEFICIARIO,
Cast(A2.CardName As Char (40)) As NOMBRE_BENEFICIARIO,
'901' As CODIGO_TRANSACCION,
'01' As TIPO_CARGO,
REPLICATE('0', 17 - Len(Replace(Cast(A1.SumApplied As Numeric(15,2)),'.',''))) + Replace(Cast(A1.SumApplied As Numeric(15,2)),'.','') As VALOR_NETO,
Cast(A1.DocEntry As Char (10)) As NUMERO_FACTURA,
'000000' As NUMERO_CONTROL_PAGO,
REPLICATE('0', 17 - Len(Replace(Cast(A1.WtAppld As Numeric(15,2)),'.',''))) + Replace(Cast(A1.WtAppld As Numeric(15,2)),'.','') As VALOR_RETENCION ,
REPLICATE('0', 17 - Len(Replace(Cast(A1.ExpVatSum As Numeric(15,2)),'.',''))) + Replace(Cast(A1.ExpVatSum As Numeric(15,2)),'.','') As VALOR_IVA,
REPLACE(CONVERT(CHAR(10), A0.DocDate, 103), '/', '') As FECHA_PAGO,
'0000000000' As NUMERO_NOTA_DEBITO,
'000000000000000' As VALOR_NOTA_DEBITO,
REPLICATE('0', 8 - Len(IsNull(Cast(Replace(A2.BankCode,'-','0') As Nvarchar(500)),'0'))) + IsNull(Cast(Replace(A2.BankCode,'-','0') As Nvarchar(500)),'0') As CODIGO_BANCO,
REPLICATE('0', 17 - Len(IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0'))) + IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0') As NUMERO_CUENTA_ABONO,
Case When A2.DflIBAN = '01' Then '1' When A2.DflIBAN = '02' Then '2' Else '00' End CLASE_CUENTA,
Case 
	When A6.U_TicpoDocICA = 'NIT' Then 'N' 
	When A6.U_TicpoDocICA = 'CC' Then 'C' 
	When A6.U_TicpoDocICA = 'PA' Then 'P' 
	When A6.U_TicpoDocICA = 'TI' Then 'I'
	When A6.U_TicpoDocICA = 'CE' Then 'E'
	Else A6.U_TicpoDocICA
End TIPO_DOCUMENTO,
Cast('' As Char (80)) As ADENDA,
'' As MOTIVO_RECHAZO
From OVPM A0
Left join VPM2 A1 On A0.DocEntry = A1.DocNum
Left Join OCRD A2 On A0.CardCode = A2.CardCode
Left Join OPYM A3 On A0.PayMth = A3.PayMethCod
Left Join DSC1 A5 On A0.TrsfrAcct = A5.GLAccount
Left Join [@BPCO_TD] A6 On A2.U_BPCO_TDC = A6.Code
Where A0.DocDate = @FechaArchivo And IsNull(A0.CheckSum,0) = 0 And IsNull(A0.CashSum,0) = 0 And (A3.PayMethCod Like '%Trans%' Or A0.U_METOPAGO = 'Trans')
FOR XML RAW ('REGISTRO') , TYPE
),
(
Select
REPLICATE('0', 5 - Len(Cast(@Conteo+2 As nvarchar(40)))) + Cast(@Conteo+2 As nvarchar(40)) As REGISTRO,
'03' As TIPO_REGISTRO,
REPLICATE('0', 5 - Len(Cast(@Conteo+2 As nvarchar(40)))) + Cast(@Conteo+2 As nvarchar(40)) As NUMERO_REGISTRO
From OVPM A0
Left Join OPYM A1 On A0.PayMth = A1.PayMethCod
Left Join ODSC A2 On A1.BnkDflt = A2.BankCode
Left Join DSC1 A3 On A2.DfltActKey = A3.AbsEntry
Left join OADM A4 On 1 = 1
Where A0.DocDate = @FechaArchivo And IsNull(A0.CheckSum,0) = 0 And IsNull(A0.CashSum,0) = 0 And (A1.PayMethCod Like '%Trans%' Or A0.U_METOPAGO = 'Trans')
Group By A3.Street, A1.DflAccount, A4.TaxIdNum, A3.SwiftNum
FOR XML RAW ('TOTAL') , TYPE
)
FOR XML PATH ('ROOT')</value>
  </data>
  <data name="CDT2" xml:space="preserve">
    <value>Select 'CDU026NUMO'As 'NO TOCAR','CDU026NIDE' As 'NO TOCAR','CDU026NCLI'As 'NO TOCAR','CDU026TICC' As 'NO TOCAR','CDU026NRCC' As 'NO TOCAR',
'CDU026NITB'As 'NIT DEL CLIENTE RECEPTOR','CDU026NOMB' As 'NOMBRE DEL CLIENTE RECEPTOR','CDU026BANB' As 'CODIGO BANCO',
'CDU026TIPC' As '1= CTA CTE / 2= CTA AHOR','CDU026NRCB' As 'NUMERO DE CUENTA','CDU026CLAM' As 'NO TOCAR','CDU026VLRB' As 'VALOR SIN DECIMALES'
Union All
Select
Cast(Row_number() over (ORDER BY A2.LicTradNum) As nvarchar(40)) As 'NO TOCAR',
'' As 'NO TOCAR',
'BANCO COLPATRIA S.A' As 'NO TOCAR',
'6' As 'NO TOCAR',
'' As 'NO TOCAR',
Replace(IsNull(A2.LicTradNum,''),'-','') As 'NIT DEL CLIENTE RECEPTOR',
A2.CardName As 'NOMBRE DEL CLIENTE RECEPTOR',
Cast(Cast(IsNull(A2.BankCode,'') as Int) As Nvarchar(20)) As 'CODIGO BANCO',
Case when A2.DflIBAN = '01' Then '1' When A2.DflIBAN = '02' Then '2' Else '' End As '1= CTA CTE / 2= CTA AHOR',
Cast(IsNull(Cast(A2.DflAccount As Nvarchar(500)),'') As Nvarchar(50)) As 'NUMERO DE CUENTA',
'' As 'NO TOCAR',
Replace(Cast(IsNull(Sum(A0.TrsfrSum),0) As Numeric(15,0)),'.','') As 'VALOR SIN DECIMALES'
From OVPM A0
Left Join OCRD A2 On A0.CardCode = A2.CardCode
Left Join OPYM A3 On A0.PayMth = A3.PayMethCod
Left Join DSC1 A5 On A0.TrsfrAcct = A5.GLAccount
Left Join [@BPCO_TD] A6 On A2.U_BPCO_TDC = A6.Code
Where A0.DocDate = @FechaArchivo And (IsNull(A3.PayMethCod,'') Like '%CDT%' Or A0.U_METOPAGO = 'CDT') And Cast(IsNull(A2.BankCode,'') As Int) != '19'
Group By A2.LicTradNum, A2.CardName, A2.BankCode, A2.DflIBAN, A2.DflAccount</value>
  </data>
  <data name="UsuariosPSE1" xml:space="preserve">
    <value>Select * from (
Select
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
'01' +
Cast(IsNull(A0.NumAtCard,'') As Char(35)) +
'00' +
Cast(UPPER(Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A0.CardName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u ') ) as Char(50)) +
Space(50) As Cadena
From ORDR A0
Inner Join RDR1 A1 ON A0.DocEntry = A1.DocEntry
Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
Where DocStatus = 'O' --And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A1.BaseType &lt;&gt; '-1'
Group By A2.LicTradNum, A1.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A4.U_SEICogn, A0.DocTotal, A0.PaidToDate, A0.CardName 
) C0 Group By Cadena</value>
  </data>
  <data name="CarteraPSE1" xml:space="preserve">
    <value>Set @Valor =
(
	Select Sum(Valor) As Total from 
		(
			Select
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			REPLICATE('0', 35 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			Cast(A0.DocEntry As char(80)) +
			Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('00' As Char(40)) + 
			Cast(UPPER('COSTOS EDUCATIVOS '+
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadena1 ,
			A0.DocTotal-IsNull(A0.PaidToDate,0) as Valor,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', A0.NumAtCard, A0.DocEntry, 2 As Orden
			From ORDR A0
			--Inner Join RDR1 A1 ON A0.DocEntry = A1.DocEntry
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Where DocStatus = 'O' AND A4.U_SEI_PSE &lt;&gt; 'N' --And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A0.BaseType &lt;&gt; '-1'
			Group By A2.LicTradNum, A0.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A4.U_SEICogn, A0.DocTotal, A0.PaidToDate
			Union All
			/*Lineas Copceptos*/
			Select 
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			REPLICATE('0', 35 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			Cast(A1.DocEntry As char(80)) +
			Cast(IsNull(A1.U_SEICAlum,'') As Char(80)) +
			Cast('01' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A6.ItemName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadena1 ,
			A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 As Valor,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', A0.NumAtCard, A1.DocEntry , 4 As Orden
			From ORDR A0
			Inner Join RDR1 A1 ON A0.DocEntry = A1.DocEntry
			Inner Join OITM A6 ON A1.ItemCode = A6.ItemCode 
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On A1.U_SEICAlum = A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc
			Where DocStatus = 'O' AND A4.U_SEI_PSE &lt;&gt; 'N' --And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A1.BaseType &lt;&gt; '-1'
		)P0
)
Set @Conteo = 
(
	Select C0.Filas From 
	(
		Select Count(*) As Filas from 
		(
			Select
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			REPLICATE('0', 35 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			Cast(A0.DocEntry As char(80)) +
			Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('00' As Char(40)) + 
			Cast(UPPER('COSTOS EDUCATIVOS '+
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
			REPLICATE('0', 18 - DATALENGTH(Replace(Cast((A0.DocTotal-IsNull(A0.PaidToDate,0)) as numeric(16,2)),'.',''))) + Replace(Cast((A0.DocTotal-IsNull(A0.PaidToDate,0)) as numeric(16,2)),'.','') +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', A0.NumAtCard, A0.DocEntry, 2 As Orden
			From ORDR A0
			--Inner Join RDR1 A1 ON A0.DocEntry = A1.DocEntry
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Where DocStatus = 'O' AND A4.U_SEI_PSE &lt;&gt; 'N' --And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A1.BaseType &lt;&gt; '-1'
			Union All
			/*Lineas Copceptos*/
			Select 
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			REPLICATE('0', 35 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			Cast(A1.DocEntry As char(80)) +
			Cast(IsNull(A1.U_SEICAlum,'') As Char(80)) +
			Cast('01' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A6.ItemName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
			REPLICATE('0', 18 - DATALENGTH(Replace(Cast(A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 as numeric(16,2)),'.',''))) + Replace(Cast(A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 as numeric(16,2)),'.','') +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', A0.NumAtCard, A1.DocEntry, 4 As Orden
			From ORDR A0
			Inner Join RDR1 A1 ON A0.DocEntry = A1.DocEntry
			Inner Join OITM A6 ON A1.ItemCode = A6.ItemCode 
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On A1.U_SEICAlum = A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc
			Where DocStatus = 'O' AND A4.U_SEI_PSE &lt;&gt; 'N'--And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A1.BaseType &lt;&gt; '-1'
		)P0
	) C0
)
/*Cabecera Archivo*/
Select T0.Cadena From (
Select C0.* From (
Select
'1' +
Convert(VARCHAR(8), GetDate(), 112) +
REPLICATE('0', 6 - DATALENGTH(LTRIM(@Conteo))) + LTRIM(@Conteo) +
REPLICATE('0', 18 - DATALENGTH(Replace(Cast(@Valor as numeric(16,2)),'.',''))) + Replace(Cast(@Valor as numeric(16,2)),'.','') +
@Consec +
Space(527) As Cadena, 0 As NumAtCard, 0 As DocEntry, 1 As Orden
)C0

Union All

Select C0.* from (
/*Cabecera Factura 00*/
Select
'2' +
REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
REPLICATE('0', 35 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') + 
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
Cast(A0.DocEntry As char(80)) +
Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
Cast('00' As Char(40)) + 
Cast(UPPER('COSTOS EDUCATIVOS '+
Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u') + ' ' +
Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEICogn,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
'0' +
Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
REPLICATE('0', 18 - DATALENGTH(Replace(Cast((A0.DocTotal-IsNull(A0.PaidToDate,0)) as numeric(16,2)),'.',''))) + Replace(Cast((A0.DocTotal-IsNull(A0.PaidToDate,0)) as numeric(16,2)),'.','') +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', A0.NumAtCard, A0.DocEntry, 2 As Orden
From ORDR A0
--Inner Join RDR1 A1 ON A0.DocEntry = A1.DocEntry
Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
Where DocStatus = 'O' AND A4.U_SEI_PSE &lt;&gt; 'N' --And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A1.BaseType &lt;&gt; '-1'
Group By A2.LicTradNum, A0.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A4.U_SEICogn, A0.DocTotal, A0.PaidToDate
Union All
/*Lineas Copceptos*/
Select 
'2' +
REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
REPLICATE('0', 35 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') + 
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
Cast(A1.DocEntry As char(80)) +
Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
Cast('01' As Char(40)) + 
Cast(UPPER(
Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A6.ItemName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
'0' +
Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
REPLICATE('0', 18 - DATALENGTH(Replace(Cast(A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 as numeric(16,2)),'.',''))) + Replace(Cast(A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 as numeric(16,2)),'.','') +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', A0.NumAtCard, A1.DocEntry , 4 As Orden
From ORDR A0
Inner Join RDR1 A1 ON A0.DocEntry = A1.DocEntry
Inner Join OITM A6 ON A1.ItemCode = A6.ItemCode 
Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On A1.U_SEICAlum = A4.Code
Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc
Where DocStatus = 'O' AND A4.U_SEI_PSE &lt;&gt; 'N' --And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A1.BaseType &lt;&gt; '-1'
)C0
)T0
Where IsNull(Cadena,'') &lt;&gt; ''
Order By T0.DocEntry, T0.Orden</value>
  </data>
  <data name="UsuariosPSE" xml:space="preserve">
    <value>Select * from (
Select
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
'01' +
Cast(IsNull(A0.NumAtCard,'') As Char(35)) +
'00' +
Cast(UPPER(Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A0.CardName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u ') ) as Char(50)) +
Space(50) As Cadena
From OINV A0
Inner Join INV1 A1 On A0.DocEntry = A1.DocEntry
Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A0.U_SEI_FACTU = '1' And 
A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()) /*And NumAtCard = '491'*/) And A1.TargetType != '14' 
Group By A2.LicTradNum, A0.NumAtCard, A0.CardName
Union All
Select
CASE WHEN CHARINDEX('-', A8.LicTradNum) &gt; 0 THEN Cast(LEFT(A8.LicTradNum, CHARINDEX('-', A8.LicTradNum)-1) As char(80)) ELSE Cast(A8.LicTradNum As char(80)) END +
'01' +
Cast(IsNull(A2.NumAtCard,'') As Char(35)) +
'00' +
Cast(UPPER(Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A8.CardName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u ') ) as Char(50)) +
Space(50) As Cadena
From OJDT A0 
Inner Join JDT1 A1 On A0.TransId = A1.TransId 
Left Join OINV A2 On A0.Ref1 = A2.DocNum 
Left Join RCT2 A3 On A0.TransId = A3.DocEntry And A0.ObjType = A3.InvType 
Left Join ORCT A4 On A3.DocNum = A4.DocEntry 
Left Join [@SEI_ALUMNOS] A5 On IsNull(A2.NumAtCard,'') = A5.Code
Left Join [@SEI_CURSOS] A6 On A5.U_SEICurso = A6.Code
Left Join [@SEI_SRVCODE] A7 On A2.U_SEI_FACTU = A7.Code
Inner Join OCRD A8 ON A2.CardCode = A8.CardCode
Left Join OADM A9 On 1 = 1
Where A0.TransCode = 'INT' And A2.U_SEI_FACTU = '1' And IsNull(A0.StornoToTr,'') = '' And A1.BalDueDeb &gt; 0 /*And A0.Ref2 = '491' */
Group By A8.LicTradNum, A2.NumAtCard, A8.CardName
) C0 Group By Cadena</value>
  </data>
</root>