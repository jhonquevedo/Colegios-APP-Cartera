<?xml version="1.0" encoding="utf-8"?>
<root>
  <!-- 
    Microsoft ResX Schema 
    
    Version 2.0
    
    The primary goals of this format is to allow a simple XML format 
    that is mostly human readable. The generation and parsing of the 
    various data types are done through the TypeConverter classes 
    associated with the data types.
    
    Example:
    
    ... ado.net/XML headers & schema ...
    <resheader name="resmimetype">text/microsoft-resx</resheader>
    <resheader name="version">2.0</resheader>
    <resheader name="reader">System.Resources.ResXResourceReader, System.Windows.Forms, ...</resheader>
    <resheader name="writer">System.Resources.ResXResourceWriter, System.Windows.Forms, ...</resheader>
    <data name="Name1"><value>this is my long string</value><comment>this is a comment</comment></data>
    <data name="Color1" type="System.Drawing.Color, System.Drawing">Blue</data>
    <data name="Bitmap1" mimetype="application/x-microsoft.net.object.binary.base64">
        <value>[base64 mime encoded serialized .NET Framework object]</value>
    </data>
    <data name="Icon1" type="System.Drawing.Icon, System.Drawing" mimetype="application/x-microsoft.net.object.bytearray.base64">
        <value>[base64 mime encoded string representing a byte array form of the .NET Framework object]</value>
        <comment>This is a comment</comment>
    </data>
                
    There are any number of "resheader" rows that contain simple 
    name/value pairs.
    
    Each data row contains a name, and value. The row also contains a 
    type or mimetype. Type corresponds to a .NET class that support 
    text/value conversion through the TypeConverter architecture. 
    Classes that don't support this are serialized and stored with the 
    mimetype set.
    
    The mimetype is used for serialized objects, and tells the 
    ResXResourceReader how to depersist the object. This is currently not 
    extensible. For a given mimetype the value must be set accordingly:
    
    Note - application/x-microsoft.net.object.binary.base64 is the format 
    that the ResXResourceWriter will generate, however the reader can 
    read any of the formats listed below.
    
    mimetype: application/x-microsoft.net.object.binary.base64
    value   : The object must be serialized with 
            : System.Runtime.Serialization.Formatters.Binary.BinaryFormatter
            : and then encoded with base64 encoding.
    
    mimetype: application/x-microsoft.net.object.soap.base64
    value   : The object must be serialized with 
            : System.Runtime.Serialization.Formatters.Soap.SoapFormatter
            : and then encoded with base64 encoding.

    mimetype: application/x-microsoft.net.object.bytearray.base64
    value   : The object must be serialized into a byte array 
            : using a System.ComponentModel.TypeConverter
            : and then encoded with base64 encoding.
    -->
  <xsd:schema id="root" xmlns="" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata">
    <xsd:import namespace="http://www.w3.org/XML/1998/namespace" />
    <xsd:element name="root" msdata:IsDataSet="true">
      <xsd:complexType>
        <xsd:choice maxOccurs="unbounded">
          <xsd:element name="metadata">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" />
              </xsd:sequence>
              <xsd:attribute name="name" use="required" type="xsd:string" />
              <xsd:attribute name="type" type="xsd:string" />
              <xsd:attribute name="mimetype" type="xsd:string" />
              <xsd:attribute ref="xml:space" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="assembly">
            <xsd:complexType>
              <xsd:attribute name="alias" type="xsd:string" />
              <xsd:attribute name="name" type="xsd:string" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="data">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
                <xsd:element name="comment" type="xsd:string" minOccurs="0" msdata:Ordinal="2" />
              </xsd:sequence>
              <xsd:attribute name="name" type="xsd:string" use="required" msdata:Ordinal="1" />
              <xsd:attribute name="type" type="xsd:string" msdata:Ordinal="3" />
              <xsd:attribute name="mimetype" type="xsd:string" msdata:Ordinal="4" />
              <xsd:attribute ref="xml:space" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="resheader">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
              </xsd:sequence>
              <xsd:attribute name="name" type="xsd:string" use="required" />
            </xsd:complexType>
          </xsd:element>
        </xsd:choice>
      </xsd:complexType>
    </xsd:element>
  </xsd:schema>
  <resheader name="resmimetype">
    <value>text/microsoft-resx</value>
  </resheader>
  <resheader name="version">
    <value>2.0</value>
  </resheader>
  <resheader name="reader">
    <value>System.Resources.ResXResourceReader, System.Windows.Forms, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
  </resheader>
  <resheader name="writer">
    <value>System.Resources.ResXResourceWriter, System.Windows.Forms, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
  </resheader>
  <data name="CajaSocial" xml:space="preserve">
    <value>Select
'6' + 
Case when A2.DflIBAN = '01' Then '22' When A2.DflIBAN = '02' Then '32' When A2.DflIBAN = '03' Then '23' When A2.DflIBAN = '04' Then '33' Else '00' End +
REPLICATE('0', 12 - DATALENGTH(Replace(Cast(sum(A1.SumApplied) As Numeric(19,2)),'.',''))) + Replace(Cast(sum(A1.SumApplied) As Numeric(19,2)),'.','') +
Cast(IsNull(A2.DflAccount,'') As Char(17)) +
'000010320' +
Cast(Replace(IsNull(A2.LicTradNum,''), '-', '') As Char(15)) +
Cast(A2.CardName As Char (22))+
Cast('V' As Char (2)) +
Space(13) +
Cast('' As Char (10)) +
Cast(A1.DocEntry As Char (30)) +
Space(27)
From OVPM A0
Left join VPM2 A1 On A0.DocEntry = A1.DocNum
Left Join OCRD A2 On A0.CardCode = A2.CardCode
Left Join OPYM A3 On A0.PayMth = A3.PayMethCod
Left Join DSC1 A5 On A0.TrsfrAcct = A5.GLAccount
Left Join [@BPCO_TD] A6 On A2.U_BPCO_TDC = A6.Code
Where A0.DocDate = @FechaArchivo And IsNull(A3.PayMethCod,'') Like '%Caja%' And IsNull(A0.CheckSum,0) = 0 And IsNull(A0.CashSum,0) = 0
Group By A2.DflAccount, A2.LicTradNum, A2.CardName, A5.AcctName, A2.DflIBAN, A1.DocEntry</value>
  </data>
  <data name="CarteraPSE" xml:space="preserve">
    <value>Set @Valor =
(
	Select SUM(CAST(SUBSTRING(P0.Cadena,449,8) as numeric(16,2)))  As Total from 
		(			
			
			Select C0.* from (
			/*Cabecera Factura 00*/
			Select P0.Cadena1 + REPLICATE('0', 18 - DATALENGTH(Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.',''))) + Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.','') + P0.Cadena As Cadena,
			CASE WHEN CHARINDEX('-', P0.NumAtCard) &gt; 0 THEN LEFT(P0.NumAtCard, CHARINDEX('-', P0.NumAtCard)-1) ELSE P0.NumAtCard  END as NumAtCard ,0 DocEntry, 2 As Orden
			From (
			Select
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			--Cast(A0.DocEntry As char(80)) +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('00' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadena1,
			CAST(A0.DocTotal-IsNull(A0.PaidToDate,0) as INT) As Valor ,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard END as NumAtCard, A0.DocEntry, 2 As Orden
			From OINV A0
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A0.U_SEI_FACTU = '1' AND A0.CardCode != 'C9999'
			Group By A2.LicTradNum, A0.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A0.DocTotal, A0.PaidToDate

			Union 


			Select
			'2' +
			REPLICATE('0', 34 - Len(IsNull('1021',''))) + IsNull('1021','') + 
			CAST(REPLICATE('0', 30 - Len(IsNull('100',''))) + IsNull('100','') as char (36)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN Cast(LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) As char(80)) ELSE Cast(A0.Ref2 As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN Cast(LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) As char(80)) ELSE Cast(A0.Ref2 As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('00' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadean1, 
			CAST(IsNull(A8.BalDueDeb ,0) as INT) As Valor,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) ELSE A0.Ref2 END as NumAtCard, 0 as DocEntry, 2 As Orden
			From  OJDT A0
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.Ref2 ,'') = A4.Code
			--Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join JDT1 A8 On A0.TransId = A8.TransId
			Inner Join OCRD A2 ON A8.ShortName  = A2.CardCode
			Where A8.BalDueDeb &gt; 0 And A0.TransCode = 'INT' 
			Group By A2.LicTradNum, A3.U_EtyCode, A0.Ref2, A8.Debit, A8.BalDueDeb , A4.U_SEINom 
			) P0 
			Group By P0.Cadena1, P0.cadena, P0.NumAtCard

			--/*Lineas*/
			--/*Conceptos Factura 01*/
			Union All
			Select 
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('01' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A6.ItemName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
			--REPLICATE('0', 16 - DATALENGTH(Replace(Cast(A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 as INT),'.',''))) + Replace(Cast(A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 as INT),'.','') + '00' +
			REPLICATE('0', 16 - DATALENGTH(Replace(Cast(A1.LineTotal+ ISNULL((SELECT  T0.LineTotal FROM INV1 T0 WHERE T0.DocEntry = A0.DocEntry  and  T0.ItemCode = A6.U_SEI_ADE),0) as INT),'.',''))) + Replace(Cast(A1.LineTotal+ISNULL((SELECT  T0.LineTotal FROM INV1 T0 WHERE T0.DocEntry = A0.DocEntry  and  T0.ItemCode = A6.U_SEI_ADE),0) as INT),'.','') + '00' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard  END as NumAtCard, A0.DocEntry , 3 As Orden
			From OINV A0
			Inner Join INV1 A1 ON A0.DocEntry = A1.DocEntry
			Inner Join OITM A6 ON A1.ItemCode = A6.ItemCode 
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On A1.U_SEICAlum = A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc AND A11.U_SEIFeUlF = A0.DocDate 
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A0.U_SEI_FACTU = '1' And A1.LineTotal &gt; 0 AND A0.CardCode != 'C9999' AND A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())) AND  (A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100) &gt; 0 AND IsNull(A0.PaidToDate,0) = 0

			UNION ALL
			/*Saldo Del Mes */

			Select P0.Cadena1 + REPLICATE('0', 18 - DATALENGTH(Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.',''))) + Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.','') + P0.Cadena As Cadena,
			P0.NumAtCard, 0 DocEntry, 5 As Orden
			From (
			Select
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('01' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull('SALDO MES ACTUAL',''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadena1,
			CAST(A0.DocTotal-IsNull(A0.PaidToDate,0) AS INT) As Valor ,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard  END as NumAtCard, A0.DocEntry, 3 As Orden
			From OINV A0
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A0.U_SEI_FACTU = '1' AND A0.CardCode != 'C9999' AND A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())) AND IsNull(A0.PaidToDate,0) &gt; 0
			Group By A2.LicTradNum, A0.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A0.DocTotal, A0.PaidToDate

			) P0 
			Group By P0.Cadena1, P0.cadena, P0.NumAtCard


			UNION ALL
			/*Saldo Anterior */
			Select P0.Cadena1 + REPLICATE('0', 18 - DATALENGTH(Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.',''))) + Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.','') + P0.Cadena As Cadena,
			P0.NumAtCard, 0 DocEntry, 5 As Orden
			From (
			Select
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('01' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull('SALDO ANTERIOR',''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadena1,
			CAST(A0.DocTotal-IsNull(A0.PaidToDate,0) AS INT) As Valor ,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard  END as NumAtCard, A0.DocEntry, 5 As Orden
			From OINV A0
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A0.U_SEI_FACTU = '1' AND A0.CardCode != 'C9999' AND A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()))
			Group By A2.LicTradNum, A0.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A0.DocTotal, A0.PaidToDate

			Union 

			Select
			'2' +
			REPLICATE('0', 34 - Len(IsNull('1021',''))) + IsNull('1021','') + 
			CAST(REPLICATE('0', 30 - Len(IsNull('100',''))) + IsNull('100','') as char (36)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN Cast(LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) As char(80)) ELSE Cast(A0.Ref2 As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN Cast(LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) As char(80)) ELSE Cast(A0.Ref2 As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('01' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull('SALDO ANTERIOR',''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadean1, 
			CAST(IsNull(A8.BalDueDeb ,0) AS INT) As Valor,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) ELSE A0.Ref2 END as NumAtCard, 0 as DocEntry, 5 As Orden
			From  OJDT A0
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.Ref2 ,'') = A4.Code
			--Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join JDT1 A8 On A0.TransId = A8.TransId
			Inner Join OCRD A2 ON A8.ShortName  = A2.CardCode
			Where A8.BalDueDeb &gt; 0 And A0.TransCode = 'INT' 
			Group By A2.LicTradNum, A3.U_EtyCode, A0.Ref2, A8.Debit, A8.BalDueDeb 
			) P0 
			Group By P0.Cadena1, P0.cadena, P0.NumAtCard


			/*Lineas*/
			)C0

		)P0
)

Set @Conteo = 
(
	Select C0.Filas From 
	(
		Select Count(*) As Filas from 
		(
			Select P0.Cadena1 + REPLICATE('0', 18 - DATALENGTH(Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.',''))) + Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.','') + P0.Cadena As Cadena,
			CASE WHEN CHARINDEX('-', P0.NumAtCard) &gt; 0 THEN LEFT(P0.NumAtCard, CHARINDEX('-', P0.NumAtCard)-1) ELSE P0.NumAtCard  END as NumAtCard ,0 DocEntry, 2 As Orden
			From (
			Select
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			--Cast(A0.DocEntry As char(80)) +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('00' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadena1,
			CAST(A0.DocTotal-IsNull(A0.PaidToDate,0) as INT) As Valor ,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard END as NumAtCard, A0.DocEntry, 2 As Orden
			From OINV A0
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A0.U_SEI_FACTU = '1' AND A0.CardCode != 'C9999'
			Group By A2.LicTradNum, A0.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A0.DocTotal, A0.PaidToDate

			Union 


			Select
			'2' +
			REPLICATE('0', 34 - Len(IsNull('1021',''))) + IsNull('1021','') + 
			CAST(REPLICATE('0', 30 - Len(IsNull('100',''))) + IsNull('100','') as char (36)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN Cast(LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) As char(80)) ELSE Cast(A0.Ref2 As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN Cast(LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) As char(80)) ELSE Cast(A0.Ref2 As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('00' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A4.U_SEINom,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadean1, 
			CAST(IsNull(A8.BalDueDeb ,0) as INT) As Valor,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) ELSE A0.Ref2 END as NumAtCard, 0 as DocEntry, 2 As Orden
			From  OJDT A0
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.Ref2 ,'') = A4.Code
			--Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join JDT1 A8 On A0.TransId = A8.TransId
			Inner Join OCRD A2 ON A8.ShortName  = A2.CardCode
			Where A8.BalDueDeb &gt; 0 And A0.TransCode = 'INT' 
			Group By A2.LicTradNum, A3.U_EtyCode, A0.Ref2, A8.Debit, A8.BalDueDeb , A4.U_SEINom 
			) P0 
			Group By P0.Cadena1, P0.cadena, P0.NumAtCard

			--/*Lineas*/
			--/*Conceptos Factura 01*/
			Union All
			Select 
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('01' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A6.ItemName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
			--REPLICATE('0', 16 - DATALENGTH(Replace(Cast(A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 as INT),'.',''))) + Replace(Cast(A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100 as INT),'.','') + '00' +
			REPLICATE('0', 16 - DATALENGTH(Replace(Cast(A1.LineTotal+ ISNULL((SELECT  T0.LineTotal FROM INV1 T0 WHERE T0.DocEntry = A0.DocEntry  and  T0.ItemCode = A6.U_SEI_ADE),0) as INT),'.',''))) + Replace(Cast(A1.LineTotal+ISNULL((SELECT  T0.LineTotal FROM INV1 T0 WHERE T0.DocEntry = A0.DocEntry  and  T0.ItemCode = A6.U_SEI_ADE),0) as INT),'.','') + '00' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard  END as NumAtCard, A0.DocEntry , 3 As Orden
			From OINV A0
			Inner Join INV1 A1 ON A0.DocEntry = A1.DocEntry
			Inner Join OITM A6 ON A1.ItemCode = A6.ItemCode 
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On A1.U_SEICAlum = A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc AND A11.U_SEIFeUlF = A0.DocDate 
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A0.U_SEI_FACTU = '1' And A1.LineTotal &gt; 0 AND A0.CardCode != 'C9999' AND A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())) AND  (A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100) &gt; 0 AND IsNull(A0.PaidToDate,0) = 0

			UNION ALL
			/*Saldo Del Mes */

			Select P0.Cadena1 + REPLICATE('0', 18 - DATALENGTH(Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.',''))) + Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.','') + P0.Cadena As Cadena,
			P0.NumAtCard, 0 DocEntry, 5 As Orden
			From (
			Select
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('01' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull('SALDO MES ACTUAL',''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadena1,
			CAST(A0.DocTotal-IsNull(A0.PaidToDate,0) AS INT) As Valor ,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard  END as NumAtCard, A0.DocEntry, 3 As Orden
			From OINV A0
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A0.U_SEI_FACTU = '1' AND A0.CardCode != 'C9999' AND A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())) AND IsNull(A0.PaidToDate,0) &gt; 0
			Group By A2.LicTradNum, A0.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A0.DocTotal, A0.PaidToDate

			) P0 
			Group By P0.Cadena1, P0.cadena, P0.NumAtCard


			UNION ALL
			/*Saldo Anterior */
			Select P0.Cadena1 + REPLICATE('0', 18 - DATALENGTH(Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.',''))) + Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.','') + P0.Cadena As Cadena,
			P0.NumAtCard, 0 DocEntry, 5 As Orden
			From (
			Select
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('01' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull('SALDO ANTERIOR',''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadena1,
			CAST(A0.DocTotal-IsNull(A0.PaidToDate,0) AS INT) As Valor ,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard  END as NumAtCard, A0.DocEntry, 5 As Orden
			From OINV A0
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A0.U_SEI_FACTU = '1' AND A0.CardCode != 'C9999' AND A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()))
			Group By A2.LicTradNum, A0.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A0.DocTotal, A0.PaidToDate

			Union 

			Select
			'2' +
			REPLICATE('0', 34 - Len(IsNull('1021',''))) + IsNull('1021','') + 
			CAST(REPLICATE('0', 30 - Len(IsNull('100',''))) + IsNull('100','') as char (36)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN Cast(LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) As char(80)) ELSE Cast(A0.Ref2 As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN Cast(LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) As char(80)) ELSE Cast(A0.Ref2 As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('01' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull('SALDO ANTERIOR',''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadean1, 
			CAST(IsNull(A8.BalDueDeb ,0) AS INT) As Valor,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) ELSE A0.Ref2 END as NumAtCard, 0 as DocEntry, 5 As Orden
			From  OJDT A0
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.Ref2 ,'') = A4.Code
			--Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join JDT1 A8 On A0.TransId = A8.TransId
			Inner Join OCRD A2 ON A8.ShortName  = A2.CardCode
			Where A8.BalDueDeb &gt; 0 And A0.TransCode = 'INT' 
			Group By A2.LicTradNum, A3.U_EtyCode, A0.Ref2, A8.Debit, A8.BalDueDeb 
			) P0 
			Group By P0.Cadena1, P0.cadena, P0.NumAtCard

		)P0
	) C0
)


----------------------------------------------------------------------ARCHIVO-------------------------------------------------------------------------------------------------



/*Cabecera Archivo*/
Select T0.Cadena From (
Select C0.* From (
Select
'1' +
Convert(VARCHAR(8), GetDate(), 112) +
REPLICATE('0', 6 - DATALENGTH(LTRIM(@Conteo))) + LTRIM(@Conteo) +
REPLICATE('0', 18 - DATALENGTH(Replace(Cast(@Valor as numeric(16,2)),'.',''))) + Replace(Cast(@Valor as numeric(16,2)),'.','') +
@Consec +
Space(527) As Cadena, 0 As NumAtCard, 0 As DocEntry, 1 As Orden
)C0

Union All

Select C0.* from (
/*Cabecera Factura 00*/
Select P0.Cadena1 + REPLICATE('0', 18 - DATALENGTH(Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.',''))) + Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.','') + P0.Cadena As Cadena,
CASE WHEN CHARINDEX('-', P0.NumAtCard) &gt; 0 THEN LEFT(P0.NumAtCard, CHARINDEX('-', P0.NumAtCard)-1) ELSE P0.NumAtCard  END as NumAtCard ,0 DocEntry, 2 As Orden
From (
Select
'2' +
REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
--Cast(A0.DocEntry As char(80)) +
CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
Cast('00' As Char(40)) + 
Cast(UPPER(
Replace(Replace(Replace(Replace(Replace(Replace(IsNull(CONCAT (A4.U_SEINom,' ',A4.U_SEICogn),''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
'0' +
Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadena1,
CAST(A0.DocTotal-IsNull(A0.PaidToDate,0) as INT) As Valor ,
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard END as NumAtCard, A0.DocEntry, 2 As Orden
From OINV A0
Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A0.U_SEI_FACTU = '1' AND A0.CardCode != 'C9999'
--and A4.Code = '2014156-0'
Group By A2.LicTradNum, A0.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A0.DocTotal, A0.PaidToDate,A4.U_SEICogn

Union 


Select
'2' +
REPLICATE('0', 34 - Len(IsNull('1021',''))) + IsNull('1021','') + 
CAST(REPLICATE('0', 30 - Len(IsNull('100',''))) + IsNull('100','') as char (36)) + 
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN Cast(LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) As char(80)) ELSE Cast(A0.Ref2 As char(80)) END +
CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN Cast(LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) As char(80)) ELSE Cast(A0.Ref2 As char(80)) END +
--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
Cast('00' As Char(40)) + 
Cast(UPPER(
Replace(Replace(Replace(Replace(Replace(Replace(IsNull(CONCAT (A4.U_SEINom,' ',A4.U_SEICogn),''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
'0' +
Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadean1, 
CAST(IsNull(A8.BalDueDeb ,0) as INT) As Valor,
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) ELSE A0.Ref2 END as NumAtCard, 0 as DocEntry, 2 As Orden
From  OJDT A0
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.Ref2 ,'') = A4.Code
--Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Left Join JDT1 A8 On A0.TransId = A8.TransId
Inner Join OCRD A2 ON A8.ShortName  = A2.CardCode
Where A8.BalDueDeb &gt; 0 And A0.TransCode = 'INT' 
--and A4.Code = '2014156-0'
Group By A2.LicTradNum, A3.U_EtyCode, A0.Ref2, A8.Debit, A8.BalDueDeb , A4.U_SEINom,A4.U_SEICogn
) P0 
Group By P0.Cadena1, P0.cadena, P0.NumAtCard

--/*Lineas*/
--/*Conceptos Factura 01*/
Union All
Select 
'2' +
REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
Cast('01' As Char(40)) + 
Cast(UPPER(
Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A6.ItemName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
'0' +
Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
REPLICATE('0', 16 - DATALENGTH(Replace(Cast(A1.LineTotal+ ISNULL((SELECT  T0.LineTotal FROM INV1 T0 WHERE T0.DocEntry = A0.DocEntry  and  T0.ItemCode = A6.U_SEI_ADE),0) as INT),'.',''))) + Replace(Cast(A1.LineTotal+ISNULL((SELECT  T0.LineTotal FROM INV1 T0 WHERE T0.DocEntry = A0.DocEntry  and  T0.ItemCode = A6.U_SEI_ADE),0) as INT),'.','') + '00' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard  END as NumAtCard, A0.DocEntry , 3 As Orden
From OINV A0
Inner Join INV1 A1 ON A0.DocEntry = A1.DocEntry
Inner Join OITM A6 ON A1.ItemCode = A6.ItemCode 
Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On A1.U_SEICAlum = A4.Code
Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc AND A11.U_SEIFeUlF = A0.DocDate 
Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A0.U_SEI_FACTU = '1' And A1.LineTotal &gt; 0 AND A0.CardCode != 'C9999' AND A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())) AND  (A1.LineTotal-A1.LineTotal*IsNull(A11.U_SEIDesE,0)/100) &gt; 0 AND IsNull(A0.PaidToDate,0) = 0
--and A4.Code = '2014156-0'

UNION ALL
/*Saldo Del Mes */

Select P0.Cadena1 + REPLICATE('0', 18 - DATALENGTH(Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.',''))) + Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.','') + P0.Cadena As Cadena,
P0.NumAtCard, 0 DocEntry, 5 As Orden
From (
Select
'2' +
REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
Cast('01' As Char(40)) + 
Cast(UPPER(
Replace(Replace(Replace(Replace(Replace(Replace(IsNull('SALDO MES ACTUAL',''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
'0' +
Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadena1,
CAST(A0.DocTotal-IsNull(A0.PaidToDate,0) AS INT) As Valor ,
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard  END as NumAtCard, A0.DocEntry, 3 As Orden
From OINV A0
Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A0.U_SEI_FACTU = '1' AND A0.CardCode != 'C9999' AND A0.DocEntry In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate())) AND IsNull(A0.PaidToDate,0) &gt; 0
--and A4.Code = '2014156-0'
Group By A2.LicTradNum, A0.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A0.DocTotal, A0.PaidToDate

) P0 
Group By P0.Cadena1, P0.cadena, P0.NumAtCard


UNION ALL
/*Saldo Anterior */
Select P0.Cadena1 + REPLICATE('0', 18 - DATALENGTH(Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.',''))) + Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.','') + P0.Cadena As Cadena,
P0.NumAtCard, 0 DocEntry, 5 As Orden
From (
Select
'2' +
REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
Cast('01' As Char(40)) + 
Cast(UPPER(
Replace(Replace(Replace(Replace(Replace(Replace(IsNull('SALDO ANTERIOR',''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
'0' +
Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadena1,
CAST(A0.DocTotal-IsNull(A0.PaidToDate,0) AS INT) As Valor ,
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard  END as NumAtCard, A0.DocEntry, 5 As Orden
From OINV A0
Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
Where DocStatus = 'O' And (A0.DocTotal-IsNull(A0.PaidToDate,0)) &gt; 0 And A0.U_SEI_FACTU = '1' AND A0.CardCode != 'C9999' AND A0.DocEntry Not In (Select DocEntry From OINV Where Month(DocDate) = Month(GetDate()))
--and A4.Code = '2014156-0'
Group By A2.LicTradNum, A0.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A0.DocTotal, A0.PaidToDate

Union 

Select
'2' +
REPLICATE('0', 34 - Len(IsNull('1021',''))) + IsNull('1021','') + 
CAST(REPLICATE('0', 30 - Len(IsNull('100',''))) + IsNull('100','') as char (36)) + 
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN Cast(LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) As char(80)) ELSE Cast(A0.Ref2 As char(80)) END +
CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN Cast(LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) As char(80)) ELSE Cast(A0.Ref2 As char(80)) END +
--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
Cast('01' As Char(40)) + 
Cast(UPPER(
Replace(Replace(Replace(Replace(Replace(Replace(IsNull('SALDO ANTERIOR',''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
'0' +
Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadean1, 
CAST(IsNull(A8.BalDueDeb ,0) AS INT) As Valor,
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', CASE WHEN CHARINDEX('-', A0.Ref2) &gt; 0 THEN LEFT(A0.Ref2, CHARINDEX('-', A0.Ref2)-1) ELSE A0.Ref2 END as NumAtCard, 0 as DocEntry, 5 As Orden
From  OJDT A0
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.Ref2 ,'') = A4.Code
--Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Left Join JDT1 A8 On A0.TransId = A8.TransId
Inner Join OCRD A2 ON A8.ShortName  = A2.CardCode
Where A8.BalDueDeb &gt; 0 And A0.TransCode = 'INT' 
--and A4.Code = '2014156-0'
Group By A2.LicTradNum, A3.U_EtyCode, A0.Ref2, A8.Debit, A8.BalDueDeb 
) P0 
Group By P0.Cadena1, P0.cadena, P0.NumAtCard


/*Lineas*/
)C0
)T0 Order By T0.NumAtCard,  T0.Orden</value>
  </data>
  <data name="CDT" xml:space="preserve">
    <value>Select 'CDU026NUMO'As 'NO TOCAR','CDU026NIDE' As 'NO TOCAR','CDU026NCLI'As 'NO TOCAR','CDU026TICC' As 'NO TOCAR','CDU026NRCC' As 'NO TOCAR',
'CDU026NITB'As 'NIT DEL CLIENTE RECEPTOR','CDU026NOMB' As 'NOMBRE DEL CLIENTE RECEPTOR','CDU026BANB' As 'CODIGO BANCO',
'CDU026TIPC' As '1= CTA CTE / 2= CTA AHOR','CDU026NRCB' As 'NUMERO DE CUENTA','CDU026CLAM' As 'NO TOCAR','CDU026VLRB' As 'VALOR SIN DECIMALES'
Union All
Select
Cast(Row_number() over (ORDER BY A2.LicTradNum) As nvarchar(40)) As 'NO TOCAR',
'' As 'NO TOCAR',
'BANCO COLPATRIA S.A' As 'NO TOCAR',
'6' As 'NO TOCAR',
'' As 'NO TOCAR',
Replace(IsNull(A2.LicTradNum,''),'-','') As 'NIT DEL CLIENTE RECEPTOR',
A2.CardName As 'NOMBRE DEL CLIENTE RECEPTOR',
Cast(Cast(IsNull(A2.BankCode,'') as Int) As Nvarchar(20)) As 'CODIGO BANCO',
Case when A2.DflIBAN = '01' Then '1' When A2.DflIBAN = '02' Then '2' Else '' End As '1= CTA CTE / 2= CTA AHOR',
Cast(IsNull(Cast(A2.DflAccount As Nvarchar(500)),'') As Nvarchar(50)) As 'NUMERO DE CUENTA',
'' As 'NO TOCAR',
Replace(Cast(IsNull(Sum(A0.TrsfrSum),0) As Numeric(15,0)),'.','') As 'VALOR SIN DECIMALES'
From OVPM A0
Left Join OCRD A2 On A0.CardCode = A2.CardCode
Left Join OPYM A3 On A0.PayMth = A3.PayMethCod
Left Join DSC1 A5 On A0.TrsfrAcct = A5.GLAccount
Left Join [@BPCO_TD] A6 On A2.U_BPCO_TDC = A6.Code
Where A0.DocDate = @FechaArchivo And IsNull(A3.PayMethCod,'') Like '%CDT%' And Cast(IsNull(A2.BankCode,'') As Int) = '19'
Group By A2.LicTradNum, A2.CardName, A2.BankCode, A2.DflIBAN, A2.DflAccount</value>
  </data>
  <data name="Colpatria" xml:space="preserve">
    <value>Set @Conteo = 
(
	Select C0.Filas From 
	(
		Select Count(*) As Filas from 
		(
			Select
			REPLICATE('0', 5 - Len(Cast(Row_number() over (ORDER BY A1.DocEntry) + 1 As nvarchar(40)))) + Cast(Row_number() over (ORDER BY A1.DocEntry) + 1 As nvarchar(40)) As REGISTRO,
			'02' As TIPO_REGISTRO,
			REPLICATE('0', 12 - Len(IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0'))) + IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0') As NUMERO_CUENTA,
			REPLICATE('0', 11 - Len(Replace(IsNull(A2.LicTradNum,''), '-', ''))) + Replace(IsNull(A2.LicTradNum,''), '-', '') As NIT_BENEFICIARIO,
			Cast(A2.CardName As Char (40)) As NOMBRE_BENEFICIARIO,
			'901' As CODIGO_TRANSACCION,
			'01' As TIPO_CARGO,
			REPLICATE('0', 17 - Len(Replace(Cast(A1.SumApplied As Numeric(15,2)),'.',''))) + Replace(Cast(A1.SumApplied As Numeric(15,2)),'.','') As VALOR_NETO,
			Cast(A1.DocEntry As Char (10)) As NUMERO_FACTURA,
			'000000' As NUMERO_CONTROL_PAGO,
			REPLICATE('0', 17 - Len(Replace(Cast(A1.WtAppld As Numeric(15,2)),'.',''))) + Replace(Cast(A1.WtAppld As Numeric(15,2)),'.','') As VALOR_RETENCION ,
			REPLICATE('0', 17 - Len(Replace(Cast(A1.ExpVatSum As Numeric(15,2)),'.',''))) + Replace(Cast(A1.ExpVatSum As Numeric(15,2)),'.','') As VALOR_IVA,
			Cast(Convert(VARCHAR(8), A0.DocDate, 112) As char(8)) As FECHA_PAGO,
			'0000000000' As NUMERO_NOTA_DEBITO,
			'000000000000000' As VALOR_NOTA_DEBITO,
			REPLICATE('0', 8 - Len(IsNull(Cast(Replace(A2.BankCode,'-','0') As Nvarchar(500)),'0'))) + IsNull(Cast(Replace(A2.BankCode,'-','0') As Nvarchar(500)),'0') As CODIGO_BANCO,
			REPLICATE('0', 17 - Len(IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0'))) + IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0') As NUMERO_CUENTA_ABONO,
			Case When A2.DflIBAN = '01' Then '1' When A2.DflIBAN = '02' Then '2' Else '00' End CLASE_CUENTA,
			Case 
				When A6.U_TicpoDocICA = 'NIT' Then 'N' 
				When A6.U_TicpoDocICA = 'CC' Then 'C' 
				When A6.U_TicpoDocICA = 'PA' Then 'P' 
				When A6.U_TicpoDocICA = 'TI' Then 'I'
				When A6.U_TicpoDocICA = 'CE' Then 'E'
				Else A6.U_TicpoDocICA
			End TIPO_DOCUMENTO,
			Cast('' As Char (80)) As ADENDA
			From OVPM A0
			Left join VPM2 A1 On A0.DocEntry = A1.DocNum
			Left Join OCRD A2 On A0.CardCode = A2.CardCode
			Left Join OPYM A3 On A0.PayMth = A3.PayMethCod
			Left Join DSC1 A5 On A0.TrsfrAcct = A5.GLAccount
			Left Join [@BPCO_TD] A6 On A2.U_BPCO_TDC = A6.Code
			Where A0.DocDate = @FechaArchivo And IsNull(A0.CheckSum,0) = 0 And IsNull(A0.CashSum,0) = 0 And A3.PayMethCod Like '%Trans%'
		)P0
	) C0
)
--/*Cabecera Archivo*/
Select (
Select
'00001'REGISTRO,
'01' As TIPO_REGISTRO,
Convert(VARCHAR(8), @FechaArchivo, 112) As FECHA_RECIBO,
REPLICATE('0', 11 - Len(Replace(IsNull(A4.TaxIdNum,''), '-', ''))) + Replace(IsNull(A4.TaxIdNum,''), '-', '') As NIT_CLIENTE,
Cast(IsNull(A3.ControlKey,'') As Char(10)) As CLAVE,
REPLICATE('0', 6 - Len(LTRIM(@Conteo))) + LTRIM(@Conteo) As REGISTROS_ENVIADOS,
REPLICATE('0', 4 - Len(IsNull(A3.Street,''))) + IsNull(A3.Street,'') As OFICINA_PAGO,
REPLICATE('0', 12 - Len(IsNull(A3.Account,''))) + IsNull(A3.Account,'') As NUMERO_CUENTA,
Space(142) As ESPACIOLONG
From OVPM A0
Left Join OPYM A1 On A0.PayMth = A1.PayMethCod
Left Join ODSC A2 On A1.BnkDflt = A2.BankCode
Left Join DSC1 A3 On A2.DfltActKey = A3.AbsEntry
Left join OADM A4 On 1 = 1
Group By A3.Street, A3.Account, A4.TaxIdNum, A3.ControlKey
FOR XML RAW ('ENCABEZADO') , TYPE
),
(
Select
REPLICATE('0', 5 - Len(Cast(Row_number() over (ORDER BY A1.DocEntry) + 1 As nvarchar(40)))) + Cast(Row_number() over (ORDER BY A1.DocEntry) + 1 As nvarchar(40)) As REGISTRO,
'02' As TIPO_REGISTRO,
REPLICATE('0', 12 - Len(IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0'))) + IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0') As NUMERO_CUENTA,
REPLICATE('0', 11 - Len(Replace(IsNull(A2.LicTradNum,''), '-', ''))) + Replace(IsNull(A2.LicTradNum,''), '-', '') As NIT_BENEFICIARIO,
Cast(A2.CardName As Char (40)) As NOMBRE_BENEFICIARIO,
'901' As CODIGO_TRANSACCION,
'01' As TIPO_CARGO,
REPLICATE('0', 17 - Len(Replace(Cast(A1.SumApplied As Numeric(15,2)),'.',''))) + Replace(Cast(A1.SumApplied As Numeric(15,2)),'.','') As VALOR_NETO,
Cast(A1.DocEntry As Char (10)) As NUMERO_FACTURA,
'000000' As NUMERO_CONTROL_PAGO,
REPLICATE('0', 17 - Len(Replace(Cast(A1.WtAppld As Numeric(15,2)),'.',''))) + Replace(Cast(A1.WtAppld As Numeric(15,2)),'.','') As VALOR_RETENCION ,
REPLICATE('0', 17 - Len(Replace(Cast(A1.ExpVatSum As Numeric(15,2)),'.',''))) + Replace(Cast(A1.ExpVatSum As Numeric(15,2)),'.','') As VALOR_IVA,
Cast(Convert(VARCHAR(8), A0.DocDate, 112) As char(8)) As FECHA_PAGO,
'0000000000' As NUMERO_NOTA_DEBITO,
'000000000000000' As VALOR_NOTA_DEBITO,
REPLICATE('0', 8 - Len(IsNull(Cast(Replace(A2.BankCode,'-','0') As Nvarchar(500)),'0'))) + IsNull(Cast(Replace(A2.BankCode,'-','0') As Nvarchar(500)),'0') As CODIGO_BANCO,
REPLICATE('0', 17 - Len(IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0'))) + IsNull(Cast(A2.DflAccount As Nvarchar(500)),'0') As NUMERO_CUENTA_ABONO,
Case When A2.DflIBAN = '01' Then '1' When A2.DflIBAN = '02' Then '2' Else '00' End CLASE_CUENTA,
Case 
	When A6.U_TicpoDocICA = 'NIT' Then 'N' 
	When A6.U_TicpoDocICA = 'CC' Then 'C' 
	When A6.U_TicpoDocICA = 'PA' Then 'P' 
	When A6.U_TicpoDocICA = 'TI' Then 'I'
	When A6.U_TicpoDocICA = 'CE' Then 'E'
	Else A6.U_TicpoDocICA
End TIPO_DOCUMENTO,
Cast('' As Char (80)) As ADENDA
From OVPM A0
Left join VPM2 A1 On A0.DocEntry = A1.DocNum
Left Join OCRD A2 On A0.CardCode = A2.CardCode
Left Join OPYM A3 On A0.PayMth = A3.PayMethCod
Left Join DSC1 A5 On A0.TrsfrAcct = A5.GLAccount
Left Join [@BPCO_TD] A6 On A2.U_BPCO_TDC = A6.Code
Where A0.DocDate = @FechaArchivo And IsNull(A0.CheckSum,0) = 0 And IsNull(A0.CashSum,0) = 0 And A3.PayMethCod Like '%Trans%'
FOR XML RAW ('REGISTRO') , TYPE
),
(
Select
REPLICATE('0', 5 - Len(Cast(@Conteo+2 As nvarchar(40)))) + Cast(@Conteo+2 As nvarchar(40)) As REGISTRO,
--@Conteo+2 As TOTAL_REGISTRO, 
'03' As TIPO_REGISTRO,
REPLICATE('0', 5 - Len(Cast(@Conteo+2 As nvarchar(40)))) + Cast(@Conteo+2 As nvarchar(40)) As NUMERO_REGISTRO
FOR XML RAW ('TOTAL') , TYPE
)
FOR XML PATH ('ROOT')</value>
  </data>
  <data name="CDT2" xml:space="preserve">
    <value>Select 'CDU026NUMO'As 'NO TOCAR','CDU026NIDE' As 'NO TOCAR','CDU026NCLI'As 'NO TOCAR','CDU026TICC' As 'NO TOCAR','CDU026NRCC' As 'NO TOCAR',
'CDU026NITB'As 'NIT DEL CLIENTE RECEPTOR','CDU026NOMB' As 'NOMBRE DEL CLIENTE RECEPTOR','CDU026BANB' As 'CODIGO BANCO',
'CDU026TIPC' As '1= CTA CTE / 2= CTA AHOR','CDU026NRCB' As 'NUMERO DE CUENTA','CDU026CLAM' As 'NO TOCAR','CDU026VLRB' As 'VALOR SIN DECIMALES'
Union All
Select
Cast(Row_number() over (ORDER BY A2.LicTradNum) As nvarchar(40)) As 'NO TOCAR',
'' As 'NO TOCAR',
'BANCO COLPATRIA S.A' As 'NO TOCAR',
'6' As 'NO TOCAR',
'' As 'NO TOCAR',
Replace(IsNull(A2.LicTradNum,''),'-','') As 'NIT DEL CLIENTE RECEPTOR',
A2.CardName As 'NOMBRE DEL CLIENTE RECEPTOR',
Cast(Cast(IsNull(A2.BankCode,'') as Int) As Nvarchar(20)) As 'CODIGO BANCO',
Case when A2.DflIBAN = '01' Then '1' When A2.DflIBAN = '02' Then '2' Else '' End As '1= CTA CTE / 2= CTA AHOR',
Cast(IsNull(Cast(A2.DflAccount As Nvarchar(500)),'') As Nvarchar(50)) As 'NUMERO DE CUENTA',
'' As 'NO TOCAR',
Replace(Cast(IsNull(Sum(A0.TrsfrSum),0) As Numeric(15,0)),'.','') As 'VALOR SIN DECIMALES'
From OVPM A0
Left Join OCRD A2 On A0.CardCode = A2.CardCode
Left Join OPYM A3 On A0.PayMth = A3.PayMethCod
Left Join DSC1 A5 On A0.TrsfrAcct = A5.GLAccount
Left Join [@BPCO_TD] A6 On A2.U_BPCO_TDC = A6.Code
Where A0.DocDate = @FechaArchivo And IsNull(A3.PayMethCod,'') Like '%CDT%' And Cast(IsNull(A2.BankCode,'') As Int) != '19'
Group By A2.LicTradNum, A2.CardName, A2.BankCode, A2.DflIBAN, A2.DflAccount</value>
  </data>
  <data name="UsuariosPSE1" xml:space="preserve">
    <value>Select * from (
Select
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
'01' +
Cast(IsNull(A0.NumAtCard,'') As Char(35)) +
'00' +
Cast(UPPER(Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A0.CardName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u ') ) as Char(50)) +
Space(50) As Cadena
From ORDR A0
Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Where A0.DocStatus = 'O'
) C0 Group By Cadena</value>
  </data>
  <data name="CarteraPSE1" xml:space="preserve">
    <value>Set @Valor =
(
	Select SUM(CAST(SUBSTRING(P0.Cadena,449,8) as numeric(16,2)))  As Total from 
		(			
			
			Select C0.* From (
			Select
			'1' +
			Convert(VARCHAR(8), GetDate(), 112) +
			REPLICATE('0', 6 - DATALENGTH(LTRIM(@Conteo))) + LTRIM(@Conteo) +
			REPLICATE('0', 18 - DATALENGTH(Replace(Cast(@Valor as numeric(16,2)),'.',''))) + Replace(Cast(@Valor as numeric(16,2)),'.','') +
			@Consec +
			Space(527) As Cadena, 0 As NumAtCard, 0 As DocEntry, 1 As Orden
			)C0

			Union All

			Select C0.* from (
			/*Cabecera Factura 00*/
			Select P0.Cadena1 + REPLICATE('0', 18 - DATALENGTH(Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.',''))) + Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.','') + P0.Cadena As Cadena,
			CASE WHEN CHARINDEX('-', P0.NumAtCard) &gt; 0 THEN LEFT(P0.NumAtCard, CHARINDEX('-', P0.NumAtCard)-1) ELSE P0.NumAtCard  END as NumAtCard ,0 DocEntry, 2 As Orden
			From (
			Select
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			--Cast(A0.DocEntry As char(80)) +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('00' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(CONCAT (A4.U_SEINom,' ',A4.U_SEICogn),''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadena1,
			CAST(A0.DocTotal-IsNull(A0.PaidToDate,0) as INT) As Valor ,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard END as NumAtCard, A0.DocEntry, 2 As Orden
			From ORDR A0
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Where A0.DocStatus = 'O' and A0.DocDate = '20161201' --and A4.Code = '2015080-0' 
			Group By A2.LicTradNum, A0.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A4.U_SEICogn, A0.DocTotal, A0.PaidToDate
			) P0 
			Group By P0.Cadena1, P0.cadena, P0.NumAtCard
			Union All
			/*Lineas Copceptos*/
			Select --DISTINCT
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('01' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A6.ItemName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
			REPLICATE('0', 16 - DATALENGTH(Replace(Cast(A1.LineTotal+ ISNULL((SELECT  T0.LineTotal FROM RDR1 T0 WHERE T0.DocEntry = A0.DocEntry  and  T0.ItemCode = A6.U_SEI_ADE),0) as INT),'.',''))) + Replace(Cast(A1.LineTotal+ISNULL((SELECT  T0.LineTotal FROM RDR1 T0 WHERE T0.DocEntry = A0.DocEntry  and  T0.ItemCode = A6.U_SEI_ADE),0) as INT),'.','') + '00' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard  END as NumAtCard, A0.DocEntry , 3 As Orden
			From ORDR A0
			Inner Join RDR1 A1 ON A0.DocEntry = A1.DocEntry
			Inner Join OITM A6 ON A1.ItemCode = A6.ItemCode 
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On A1.U_SEICAlum = A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc
			Where A0.DocStatus = 'O' and A0.DocDate = '20161201' --and A4.Code = '2015080-0' 

			--) P0 
			--Group By P0.Cadena1, P0.cadena, P0.NumAtCard


			/*Lineas*/
			)C0

		)P0
)

Set @Conteo = 
(
	Select C0.Filas From 
	(
		Select Count(*) As Filas from 
		(
			Select P0.Cadena1 + REPLICATE('0', 18 - DATALENGTH(Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.',''))) + Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.','') + P0.Cadena As Cadena,
			CASE WHEN CHARINDEX('-', P0.NumAtCard) &gt; 0 THEN LEFT(P0.NumAtCard, CHARINDEX('-', P0.NumAtCard)-1) ELSE P0.NumAtCard  END as NumAtCard ,0 DocEntry, 2 As Orden
			From (
			Select
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			--Cast(A0.DocEntry As char(80)) +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('00' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(CONCAT (A4.U_SEINom,' ',A4.U_SEICogn),''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadena1,
			CAST(A0.DocTotal-IsNull(A0.PaidToDate,0) as INT) As Valor ,
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard END as NumAtCard, A0.DocEntry, 2 As Orden
			From ORDR A0
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Where A0.DocStatus = 'O' and A0.DocDate = '20161201' --and A4.Code = '2015080-0' 
			Group By A2.LicTradNum, A0.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A4.U_SEICogn, A0.DocTotal, A0.PaidToDate
			) P0 
			Group By P0.Cadena1, P0.cadena, P0.NumAtCard
			Union All
			/*Lineas Copceptos*/
			Select --DISTINCT
			'2' +
			REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
			CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
			CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
			--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
			Cast('01' As Char(40)) + 
			Cast(UPPER(
			Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A6.ItemName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
			'0' +
			Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
			REPLICATE('0', 16 - DATALENGTH(Replace(Cast(A1.LineTotal+ ISNULL((SELECT  T0.LineTotal FROM RDR1 T0 WHERE T0.DocEntry = A0.DocEntry  and  T0.ItemCode = A6.U_SEI_ADE),0) as INT),'.',''))) + Replace(Cast(A1.LineTotal+ISNULL((SELECT  T0.LineTotal FROM RDR1 T0 WHERE T0.DocEntry = A0.DocEntry  and  T0.ItemCode = A6.U_SEI_ADE),0) as INT),'.','') + '00' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
			REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard  END as NumAtCard, A0.DocEntry , 3 As Orden
			From ORDR A0
			Inner Join RDR1 A1 ON A0.DocEntry = A1.DocEntry
			Inner Join OITM A6 ON A1.ItemCode = A6.ItemCode 
			Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
			Inner Join OADM A3 On 1 = 1
			Left Join [@SEI_ALUMNOS] A4 On A1.U_SEICAlum = A4.Code
			Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
			Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
			Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc
			Where A0.DocStatus = 'O' and A0.DocDate = '20161201' --and A4.Code = '2015080-0' 

		)P0
	) C0
)


--------------------------------------------------------------------ARCHIVO-------------------------------------------------------------------------------------------------



/*Cabecera Archivo*/



Select T0.Cadena From (
Select C0.* From (
Select
'1' +
Convert(VARCHAR(8), GetDate(), 112) +
REPLICATE('0', 6 - DATALENGTH(LTRIM(@Conteo))) + LTRIM(@Conteo) +
REPLICATE('0', 18 - DATALENGTH(Replace(Cast(@Valor as numeric(16,2)),'.',''))) + Replace(Cast(@Valor as numeric(16,2)),'.','') +
@Consec +
Space(527) As Cadena, 0 As NumAtCard, 0 As DocEntry, 1 As Orden
)C0

Union All

Select C0.* from (
/*Cabecera Factura 00*/
Select P0.Cadena1 + REPLICATE('0', 18 - DATALENGTH(Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.',''))) + Replace(Cast(Sum(P0.Valor) as numeric(16,2)),'.','') + P0.Cadena As Cadena,
CASE WHEN CHARINDEX('-', P0.NumAtCard) &gt; 0 THEN LEFT(P0.NumAtCard, CHARINDEX('-', P0.NumAtCard)-1) ELSE P0.NumAtCard  END as NumAtCard ,0 DocEntry, 2 As Orden
From (
Select
'2' +
REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
--Cast(A0.DocEntry As char(80)) +
CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
Cast('00' As Char(40)) + 
Cast(UPPER(
Replace(Replace(Replace(Replace(Replace(Replace(IsNull(CONCAT (A4.U_SEINom,' ',A4.U_SEICogn),''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
'0' +
Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) As Cadena1,
CAST(A0.DocTotal-IsNull(A0.PaidToDate,0) as INT) As Valor ,
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' + 
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0'As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard END as NumAtCard, A0.DocEntry, 2 As Orden
From ORDR A0
Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
Where A0.DocStatus = 'O' and A0.DocDate = '20161201' --and A4.Code = '2015080-0' 
Group By A2.LicTradNum, A0.DocEntry, A0.NumAtCard, A0.DocDate, A4.Name, A3.U_EtyCode, A10.Name, A4.U_SEInom, A4.U_SEICogn, A0.DocTotal, A0.PaidToDate
) P0 
Group By P0.Cadena1, P0.cadena, P0.NumAtCard
Union All
/*Lineas Copceptos*/
Select --DISTINCT
'2' +
REPLICATE('0', 35 - Len(IsNull(A3.U_EtyCode,''))) + IsNull(A3.U_EtyCode,'') + 
CAST(REPLICATE('0', 29 - Len(IsNull(A10.Name,''))) + IsNull(A10.Name,'') as char (35)) + 
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN Cast(LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) As char(80)) ELSE Cast(A0.NumAtCard As char(80)) END +
--Cast(IsNull(A0.NumAtCard,'') As Char(80)) +
Cast('01' As Char(40)) + 
Cast(UPPER(
Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A6.ItemName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u')) as Char(80)) +
'0' +
Cast(Convert(VARCHAR(8), @FechaArchivo, 112) As char(8)) +
REPLICATE('0', 16 - DATALENGTH(Replace(Cast(A1.LineTotal+ ISNULL((SELECT  T0.LineTotal FROM RDR1 T0 WHERE T0.DocEntry = A0.DocEntry  and  T0.ItemCode = A6.U_SEI_ADE),0) as INT),'.',''))) + Replace(Cast(A1.LineTotal+ISNULL((SELECT  T0.LineTotal FROM RDR1 T0 WHERE T0.DocEntry = A0.DocEntry  and  T0.ItemCode = A6.U_SEI_ADE),0) as INT),'.','') + '00' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' +
REPLICATE('0', 8 - DATALENGTH('0')) + '0' +
REPLICATE('0', 18 - DATALENGTH('0')) + '0' As 'Cadena', CASE WHEN CHARINDEX('-', A0.NumAtCard) &gt; 0 THEN LEFT(A0.NumAtCard, CHARINDEX('-', A0.NumAtCard)-1) ELSE A0.NumAtCard  END as NumAtCard, A0.DocEntry , 3 As Orden
From ORDR A0
Inner Join RDR1 A1 ON A0.DocEntry = A1.DocEntry
Inner Join OITM A6 ON A1.ItemCode = A6.ItemCode 
Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On A1.U_SEICAlum = A4.Code
Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Left Join [@SEI_SRVCODE] A10 On A0.U_SEI_FACTU = A10.Code
Left Join [@SEI_CONC_ALUMN] A11 On A0.NumAtCard = A11.Code And A1.ItemCode = A11.U_SEIConc
Where A0.DocStatus = 'O' and A0.DocDate = '20161201' --and A4.Code = '2015080-0' 

--) P0 
--Group By P0.Cadena1, P0.cadena, P0.NumAtCard


/*Lineas*/
)C0
)T0 Order By T0.NumAtCard,  T0.Orden</value>
  </data>
  <data name="UsuariosPSE" xml:space="preserve">
    <value>Select * from (
Select
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
'01' +
--Cast(IsNull(A0.NumAtCard,'') As Char(35)) +
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(35)) ELSE Cast(A2.LicTradNum As char(35)) END +
'00' +
Cast(UPPER(Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A0.CardName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u ') ) as Char(50)) +
Space(50) As Cadena
From OINV A0
Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Where A0.DocStatus = 'O' And (A0.DocTotal-A0.PaidToDate) &gt; 0 And A0.U_SEI_FACTU = '1'
Union All
Select
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(80)) ELSE Cast(A2.LicTradNum As char(80)) END +
'01' +
--Cast(IsNull(A0.NumAtCard,'') As Char(35)) +
CASE WHEN CHARINDEX('-', A2.LicTradNum) &gt; 0 THEN Cast(LEFT(A2.LicTradNum, CHARINDEX('-', A2.LicTradNum)-1) As char(35)) ELSE Cast(A2.LicTradNum As char(35)) END +
'00' +
Cast(UPPER(Replace(Replace(Replace(Replace(Replace(Replace(IsNull(A0.CardName,''),'ñ','n'), 'á', 'a'), 'é','e'), 'í', 'i'), 'ó', 'o'), 'ú','u ') ) as Char(50)) +
Space(50) As Cadena
From OINV A0
Inner Join OCRD A2 ON A0.CardCode = A2.CardCode
Inner Join OADM A3 On 1 = 1
Left Join [@SEI_ALUMNOS] A4 On IsNull(A0.NumAtCard,'')= A4.Code
Left Join [@SEI_CURSOS] A5 On A4.U_SEICurso = A5.Code
Left Join OJDT A7 On A0.DocNum = A7.Ref1
Left Join JDT1 A8 On A7.TransId = A8.TransId
Left Join RCT2 A9 On A7.TransId = A9.DocEntry And A7.ObjType = A9.InvType
Where A0.DocStatus = 'O' And (IsNull(A8.Debit,0)-IsNull(A9.SumApplied,0)) &gt; 0 And A7.TransCode = 'INT' And A0.U_SEI_FACTU = '1'
) C0 Group By Cadena</value>
  </data>
  <data name="Bancolombia" xml:space="preserve">
    <value>Set @Conteo = 
(
	Select C0.Filas From 
	(
		Select Count(*) As Filas from 
		(
			Select
			'1' +
			REPLICATE('0', 6 - Len(LTRIM(A2.BankCode))) + LTRIM(A2.BankCode) +
			REPLICATE('0', 4 - Len(IsNull(A5.Street,''))) + IsNull(A5.Street,'') +
			REPLICATE('0', 17 - Len(IsNull(A2.DflAccount,'0'))) + IsNull(A2.DflAccount,'0') +
			Case when A2.DflIBAN = '01' Then '1' When A2.DflIBAN = '02' Then '2' Else '' End +
			REPLICATE('0', 17 - DATALENGTH(Replace(Cast(IsNull(A1.SumApplied,'0') As Numeric(19,2)),'.',''))) + Replace(Cast(IsNull(A1.SumApplied,'0') As Numeric(19,2)),'.','') As Cadena
			From OVPM A0
			Left join VPM2 A1 On A0.DocEntry = A1.DocNum
			Left Join OCRD A2 On A0.CardCode = A2.CardCode
			Left Join OPYM A3 On A0.PayMth = A3.PayMethCod
			Left Join DSC1 A5 On A0.TrsfrAcct = A5.GLAccount
			Left Join [@BPCO_TD] A6 On A2.U_BPCO_TDC = A6.Code
			Where A0.DocDate = @FechaArchivo And IsNull(A0.CheckSum,0) = 0 And IsNull(A0.CashSum,0) = 0 And (A3.PayMethCod Like '%Trans%' Or A0.U_METOPAGO = 'Trans')
		)P0
	) C0
)

Set @Valor =
(
	Select Sum(Valor) As Total from 
		(
			Select
			'1' +
			REPLICATE('0', 6 - Len(LTRIM(A2.BankCode))) + LTRIM(A2.BankCode) +
			REPLICATE('0', 4 - Len(IsNull(A5.Street,''))) + IsNull(A5.Street,'') +
			Cast(IsNull(A2.DflAccount,'') As Char(17)) +
			Case when A2.DflIBAN = '01' Then '1' When A2.DflIBAN = '02' Then '2' Else '' End As Cadena ,
			A1.SumApplied As Valor
			From OVPM A0
			Left join VPM2 A1 On A0.DocEntry = A1.DocNum
			Left Join OCRD A2 On A0.CardCode = A2.CardCode
			Left Join OPYM A3 On A0.PayMth = A3.PayMethCod
			Left Join DSC1 A5 On A0.TrsfrAcct = A5.GLAccount
			Left Join [@BPCO_TD] A6 On A2.U_BPCO_TDC = A6.Code
			Where A0.DocDate = @FechaArchivo And IsNull(A0.CheckSum,0) = 0 And IsNull(A0.CashSum,0) = 0 And (A3.PayMethCod Like '%Trans%' Or A0.U_METOPAGO = 'Trans')
		)P0
)
Select
'0' + 
'01' +
'PPE' +
Cast('2086' As Char(4)) +
Cast('2086000000668' As Char(13)) +
Cast('0000030013819' As Char(13)) +
'570110' +
REPLICATE('0', 4 - Len(IsNull(A3.Street,''))) + IsNull(A3.Street,'') +
REPLICATE('0', 17 - Len(IsNull(A3.Account,''))) + IsNull(A3.Account,'') +
Case When A3.IBAN = 'AHORROS' Then '2' When A3.IBAN = 'CORRIENTE' Then '1' Else '' End +
REPLICATE('0', 6 - Len(LTRIM(@Conteo))) + LTRIM(@Conteo) +
REPLICATE('0', 18 - DATALENGTH(Replace(Cast(@Valor as numeric(16,2)),'.',''))) + Replace(Cast(@Valor as numeric(16,2)),'.','') +
Space(100) As Cadena
From OVPM A0
Left Join OPYM A1 On A0.PayMth = A1.PayMethCod
Left Join ODSC A2 On A1.BnkDflt = A2.BankCode
Left Join DSC1 A3 On A2.DfltActKey = A3.AbsEntry
Left join OADM A4 On 1 = 1
Where A0.DocDate = @FechaArchivo And IsNull(A0.CheckSum,0) = 0 And IsNull(A0.CashSum,0) = 0 And (A1.PayMethCod Like '%Trans%' Or A0.U_METOPAGO = 'Trans')

Union

Select
'1' +
REPLICATE('0', 6 - Len(LTRIM(A2.BankCode))) + LTRIM(A2.BankCode) +
REPLICATE('0', 4 - Len(IsNull(A5.Street,''))) + IsNull(A5.Street,'') +
REPLICATE('0', 17 - Len(IsNull(A2.DflAccount,'0'))) + IsNull(A2.DflAccount,'0') +
Case when A2.DflIBAN = '01' Then '1' When A2.DflIBAN = '02' Then '2' Else '' End +
REPLICATE('0', 17 - DATALENGTH(Replace(Cast(IsNull(A1.SumApplied,'0') As Numeric(19,2)),'.',''))) + Replace(Cast(IsNull(A1.SumApplied,'0') As Numeric(19,2)),'.','') +
REPLICATE('0', 6 - Len(LTRIM(@Conteo))) + LTRIM(@Conteo) 
From OVPM A0
Left join VPM2 A1 On A0.DocEntry = A1.DocNum
Left Join OCRD A2 On A0.CardCode = A2.CardCode
Left Join OPYM A3 On A0.PayMth = A3.PayMethCod
Left Join DSC1 A5 On A0.TrsfrAcct = A5.GLAccount
Left Join [@BPCO_TD] A6 On A2.U_BPCO_TDC = A6.Code
Where A0.DocDate = @FechaArchivo And IsNull(A0.CheckSum,0) = 0 And IsNull(A0.CashSum,0) = 0 And (A3.PayMethCod Like '%Trans%' Or A0.U_METOPAGO = 'Trans')

Union

Select
'2' +
Cast(IsNull(A1.DocEntry,'') As Char(17)) +
'+' +
REPLICATE('0', 17 - DATALENGTH(Replace(Cast(IsNull(A1.SumApplied,'0') As Numeric(19,2)),'.',''))) + Replace(Cast(IsNull(A1.SumApplied,'0') As Numeric(19,2)),'.','')+
Case when A2.DflIBAN = '01' Then '1' When A2.DflIBAN = '02' Then '2' Else '' End +
'-' +
REPLICATE('0', 17 - DATALENGTH(Replace(Cast(IsNull(A1.DcntSum,'0') As Numeric(19,2)),'.',''))) + Replace(Cast(IsNull(A1.DcntSum,'0') As Numeric(19,2)),'.','')
From OVPM A0
Left join VPM2 A1 On A0.DocEntry = A1.DocNum
Left Join OCRD A2 On A0.CardCode = A2.CardCode
Left Join OPYM A3 On A0.PayMth = A3.PayMethCod
Left Join DSC1 A5 On A0.TrsfrAcct = A5.GLAccount
Left Join [@BPCO_TD] A6 On A2.U_BPCO_TDC = A6.Code
Where A0.DocDate = @FechaArchivo And IsNull(A0.CheckSum,0) = 0 And IsNull(A0.CashSum,0) = 0 And (A3.PayMethCod Like '%Trans%' Or A0.U_METOPAGO = 'Trans')</value>
  </data>
</root>